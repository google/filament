// Embed debug info

// NOTE: cd into unique directory to avoid ls *.pdb affected by pdb files generated by other tests.
// RUN: mkdir -p %T/embed_dbg && cd %T/embed_dbg
// RUN: %dxc /T ps_6_0 %S/Inputs/smoke.hlsl /Zi /Qembed_debug /Fo %t.embedpdb
// RUN: %dxc -dumpbin %t.embedpdb | FileCheck  %s --check-prefix=EMBED_PDB

// Make sure the pdb file not exist with /Zi /Qembed_debug.
// RUN: ls -1 %T/embed_dbg | not grep "\\.pdb$"

// Auto-embed debug info when no debug output, and expect warning signifying that this is the case.
// RUN: %dxc /T ps_6_0 %S/Inputs/smoke.hlsl  /Zi /Fo %t.embedpdb2 /Fe %t.err.embedpdb
// RUN: FileCheck --input-file=%t.err.embedpdb %s --check-prefix=ERR_EMBED_PDB
// ERR_EMBED_PDB:warning: no output provided for debug - embedding PDB in shader container.  Use -Qembed_debug to silence this warning.

// RUN: %dxc -dumpbin %t.embedpdb2 | FileCheck  %s --check-prefix=EMBED_PDB
// EMBED_PDB:shader debug name: {{[0-9a-z]+}}.pdb
// EMBED_PDB:DICompileUnit
