/*
 * Copyright (C) 2018 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#include <cstdlib>
#include <iomanip>
#include <iostream>

#include <getopt/getopt.h>

#include <utils/Path.h>

#include <math/mat3.h>
#include <math/scalar.h>
#include <math/vec3.h>

using namespace filament::math;

static void printUsage(const char* name) {
    std::string execName(utils::Path(name).getName());
    std::string usage(
            "RGB_TO_LMSR computes an RGB (Rec.709) to LMSR transform matrix\n"
                    "Usage:\n"
                    "    RGB_TO_LMSR\n"
                    "\n"
                    "Options:\n"
                    "   --help, -h\n"
                    "       Print this message\n\n"
                    "   --license\n"
                    "       Print copyright and license information\n\n"
    );

    const std::string from("RGB_TO_LMSR");
    for (size_t pos = usage.find(from); pos != std::string::npos; pos = usage.find(from, pos)) {
        usage.replace(pos, from.length(), execName);
    }
    printf("%s", usage.c_str());
}

static void license() {
    static const char *license[] = {
        #include "licenses/licenses.inc"
        nullptr
    };

    const char **p = &license[0];
    while (*p)
        std::cout << *p++ << std::endl;
}

static int handleArguments(int argc, char* argv[]) {
    static constexpr const char* OPTSTR = "hl:";
    static const struct option OPTIONS[] = {
        { "help",         no_argument, nullptr, 'h' },
        { "license",      no_argument, nullptr, 'l' },
        { nullptr, 0, nullptr, 0 }  // termination of the option list
    };

    int opt;
    int optionIndex = 0;

    while ((opt = getopt_long(argc, argv, OPTSTR, OPTIONS, &optionIndex)) >= 0) {
        std::string arg(optarg ? optarg : "");
        switch (opt) {
            default:
            case 'h':
                printUsage(argv[0]);
                exit(0);
            case 'l':
                license();
                exit(0);
        }
    }

    return optind;
}

// CIE 1931 reflectance spectrum for Rec.709 from 390nm to 790nm
//
// Data source:
//     http://scottburns.us/fast-rgb-to-spectrum-conversion-for-reflectances/
const size_t REC_709_REFLECTANCE_COUNT = 401;
const float3 REC_709_REFLECTANCE[REC_709_REFLECTANCE_COUNT] = { // NOLINT
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028818291f, 0.011877002f, 0.959304707f},
        {0.028811021f, 0.011877002f, 0.959311977f},
        {0.028802781f, 0.011877002f, 0.959320217f},
        {0.028793521f, 0.011877002f, 0.959329477f},
        {0.028782960f, 0.011877002f, 0.959340038f},
        {0.028770917f, 0.011877002f, 0.959352080f},
        {0.028757342f, 0.011877002f, 0.959365656f},
        {0.028741827f, 0.011877002f, 0.959381171f},
        {0.028724190f, 0.011877002f, 0.959398808f},
        {0.028704048f, 0.011877002f, 0.959418950f},
        {0.028681031f, 0.011886657f, 0.959432313f},
        {0.028654760f, 0.011897721f, 0.959447519f},
        {0.028624766f, 0.011910316f, 0.959464919f},
        {0.028590487f, 0.011924700f, 0.959484814f},
        {0.028551637f, 0.011941085f, 0.959507279f},
        {0.028507641f, 0.011959757f, 0.959532602f},
        {0.028457679f, 0.011980956f, 0.959561366f},
        {0.028401308f, 0.012005032f, 0.959593661f},
        {0.028337507f, 0.012032367f, 0.959630128f},
        {0.028265518f, 0.012063369f, 0.959671114f},
        {0.028184712f, 0.012098436f, 0.959716853f},
        {0.028093938f, 0.012138183f, 0.959767881f},
        {0.027992225f, 0.012183090f, 0.959824687f},
        {0.027878758f, 0.012233713f, 0.959887532f},
        {0.027752728f, 0.012290715f, 0.959956560f},
        {0.027613202f, 0.012354682f, 0.960032118f},
        {0.027459639f, 0.012426334f, 0.960114030f},
        {0.027291406f, 0.012506237f, 0.960202360f},
        {0.027108029f, 0.012595103f, 0.960296871f},
        {0.026909351f, 0.012693590f, 0.960397062f},
        {0.026695068f, 0.012802303f, 0.960502632f},
        {0.026465327f, 0.012922024f, 0.960612653f},
        {0.026219780f, 0.013053697f, 0.960726528f},
        {0.025958190f, 0.013198476f, 0.960843339f},
        {0.025680593f, 0.013357408f, 0.960962004f},
        {0.025387006f, 0.013531737f, 0.961081261f},
        {0.025077520f, 0.013722843f, 0.961199642f},
        {0.024752635f, 0.013932033f, 0.961315337f},
        {0.024412905f, 0.014160874f, 0.961426226f},
        {0.024058830f, 0.014411037f, 0.961530138f},
        {0.023691176f, 0.014684282f, 0.961624548f},
        {0.023310840f, 0.014982637f, 0.961706529f},
        {0.022918745f, 0.015308115f, 0.961773146f},
        {0.022516080f, 0.015663026f, 0.961820900f},
        {0.022103926f, 0.016049824f, 0.961846257f},
        {0.021683511f, 0.016471404f, 0.961845091f},
        {0.021256027f, 0.016930724f, 0.961813257f},
        {0.020822729f, 0.017431474f, 0.961745804f},
        {0.020384772f, 0.017977408f, 0.961637827f},
        {0.019943276f, 0.018573130f, 0.961483602f},
        {0.019499471f, 0.019223505f, 0.961277031f},
        {0.019054471f, 0.019934375f, 0.961011161f},
        {0.018609424f, 0.020711793f, 0.960678791f},
        {0.018165471f, 0.021562842f, 0.960271695f},
        {0.017723519f, 0.022495442f, 0.959781047f},
        {0.017284601f, 0.023518720f, 0.959196687f},
        {0.016849621f, 0.024643089f, 0.958507298f},
        {0.016419409f, 0.025880449f, 0.957700149f},
        {0.015994666f, 0.027244468f, 0.956760874f},
        {0.015576139f, 0.028750929f, 0.955672940f},
        {0.015164369f, 0.030417962f, 0.954417677f},
        {0.014759893f, 0.032266650f, 0.952973465f},
        {0.014363270f, 0.034321187f, 0.951315551f},
        {0.013974834f, 0.036609597f, 0.949415576f},
        {0.013594951f, 0.039164589f, 0.947240469f},
        {0.013223980f, 0.042024179f, 0.944751849f},
        {0.012862081f, 0.045232687f, 0.941905240f},
        {0.012509509f, 0.048841513f, 0.938648986f},
        {0.012166415f, 0.052910539f, 0.934923054f},
        {0.011832836f, 0.057509680f, 0.930657491f},
        {0.011508938f, 0.062721079f, 0.925769991f},
        {0.011194664f, 0.068641244f, 0.920164100f},
        {0.010890006f, 0.075385301f, 0.913724701f},
        {0.010594921f, 0.083088729f, 0.906316358f},
        {0.010309243f, 0.091912392f, 0.897778373f},
        {0.010032852f, 0.102044876f, 0.887922279f},
        {0.009765620f, 0.113708114f, 0.876526273f},
        {0.009507356f, 0.127159828f, 0.863332823f},
        {0.009257866f, 0.142696430f, 0.848045711f},
        {0.009016900f, 0.160651591f, 0.830331517f},
        {0.008784129f, 0.181390517f, 0.809825361f},
        {0.008559389f, 0.205290227f, 0.786150391f},
        {0.008342333f, 0.232698734f, 0.758958940f},
        {0.008132602f, 0.263880897f, 0.727986508f},
        {0.007929888f, 0.298929894f, 0.693140225f},
        {0.007733877f, 0.337660526f, 0.654605604f},
        {0.007544324f, 0.379519416f, 0.612936267f},
        {0.007361023f, 0.423563429f, 0.569075555f},
        {0.007183855f, 0.468553426f, 0.524262725f},
        {0.007012745f, 0.513160591f, 0.479826671f},
        {0.006847712f, 0.556197975f, 0.436954319f},
        {0.006688746f, 0.596774501f, 0.396536760f},
        {0.006535881f, 0.634336924f, 0.359127201f},
        {0.006389133f, 0.668637252f, 0.324973622f},
        {0.006248471f, 0.699655061f, 0.294096474f},
        {0.006113831f, 0.727519207f, 0.266366969f},
        {0.005985160f, 0.752443966f, 0.241570880f},
        {0.005862418f, 0.774683948f, 0.219453641f},
        {0.005745439f, 0.794504131f, 0.199750437f},
        {0.005634161f, 0.812162229f, 0.182203618f},
        {0.005528477f, 0.827899667f, 0.166571863f},
        {0.005428285f, 0.841936088f, 0.152635634f},
        {0.005333500f, 0.854469313f, 0.140197194f},
        {0.005244008f, 0.865675487f, 0.129080512f},
        {0.005159746f, 0.875710212f, 0.119130050f},
        {0.005080630f, 0.884710460f, 0.110208918f},
        {0.005006586f, 0.892796076f, 0.102197347f},
        {0.004937545f, 0.900072521f, 0.094989942f},
        {0.004873420f, 0.906632179f, 0.088494410f},
        {0.004814165f, 0.912555819f, 0.082630025f},
        {0.004759755f, 0.917913767f, 0.077326487f},
        {0.004710142f, 0.922768547f, 0.072521320f},
        {0.004665292f, 0.927174110f, 0.068160607f},
        {0.004625163f, 0.931178591f, 0.064196255f},
        {0.004589756f, 0.934823889f, 0.060586364f},
        {0.004559076f, 0.938146992f, 0.057293941f},
        {0.004533115f, 0.941180584f, 0.054286310f},
        {0.004511878f, 0.943953492f, 0.051534640f},
        {0.004495412f, 0.946491400f, 0.049013197f},
        {0.004483749f, 0.948816965f, 0.046699295f},
        {0.004476933f, 0.950950467f, 0.044572609f},
        {0.004475011f, 0.952909752f, 0.042615247f},
        {0.004478088f, 0.954710433f, 0.040811489f},
        {0.004486263f, 0.956366386f, 0.039147361f},
        {0.004499670f, 0.957890048f, 0.037610292f},
        {0.004518465f, 0.959292655f, 0.036188889f},
        {0.004542805f, 0.960584215f, 0.034872990f},
        {0.004572880f, 0.961773573f, 0.033653556f},
        {0.004608895f, 0.962868623f, 0.032522492f},
        {0.004651090f, 0.963876448f, 0.031472471f},
        {0.004699746f, 0.964803350f, 0.030496912f},
        {0.004755186f, 0.965655044f, 0.029589778f},
        {0.004817721f, 0.966436842f, 0.028745446f},
        {0.004887673f, 0.967153428f, 0.027958907f},
        {0.004965447f, 0.967808972f, 0.027225590f},
        {0.005051466f, 0.968407165f, 0.026541377f},
        {0.005146221f, 0.968951191f, 0.025902595f},
        {0.005250261f, 0.969443961f, 0.025305785f},
        {0.005364196f, 0.969887939f, 0.024747872f},
        {0.005488688f, 0.970285274f, 0.024226044f},
        {0.005624523f, 0.970637837f, 0.023737647f},
        {0.005772524f, 0.970947128f, 0.023280354f},
        {0.005933641f, 0.971214249f, 0.022852116f},
        {0.006108994f, 0.971440082f, 0.022450930f},
        {0.006299756f, 0.971625195f, 0.022075054f},
        {0.006507247f, 0.971769994f, 0.021722764f},
        {0.006733051f, 0.971874423f, 0.021392531f},
        {0.006978854f, 0.971938200f, 0.021082950f},
        {0.007246538f, 0.971960799f, 0.020792667f},
        {0.007538270f, 0.971941249f, 0.020520485f},
        {0.007856514f, 0.971878264f, 0.020265225f},
        {0.008204064f, 0.971770126f, 0.020025813f},
        {0.008583947f, 0.971614816f, 0.019801239f},
        {0.008999675f, 0.971409878f, 0.019590449f},
        {0.009455237f, 0.971152241f, 0.019392523f},
        {0.009955215f, 0.970838189f, 0.019206597f},
        {0.010504749f, 0.970463452f, 0.019031800f},
        {0.011109803f, 0.970022766f, 0.018867431f},
        {0.011777308f, 0.969510027f, 0.018712665f},
        {0.012515126f, 0.968918048f, 0.018566825f},
        {0.013332373f, 0.968238420f, 0.018429206f},
        {0.014239681f, 0.967461152f, 0.018299166f},
        {0.015249411f, 0.966574582f, 0.018176005f},
        {0.016375927f, 0.965564859f, 0.018059211f},
        {0.017636162f, 0.964415670f, 0.017948165f},
        {0.019050053f, 0.963107683f, 0.017842261f},
        {0.020640980f, 0.961618056f, 0.017740960f},
        {0.022436706f, 0.959919497f, 0.017643792f},
        {0.024470247f, 0.957979541f, 0.017550207f},
        {0.026781156f, 0.955759173f, 0.017459665f},
        {0.029416764f, 0.953211636f, 0.017371594f},
        {0.032434165f, 0.950280250f, 0.017285579f},
        {0.035902660f, 0.946896161f, 0.017201171f},
        {0.039906710f, 0.942975375f, 0.017117908f},
        {0.044549637f, 0.938415042f, 0.017035312f},
        {0.049957946f, 0.933089100f, 0.016952945f},
        {0.056288019f, 0.926841641f, 0.016870331f},
        {0.063732852f, 0.919480119f, 0.016787020f},
        {0.072532236f, 0.910765162f, 0.016702592f},
        {0.082984390f, 0.900398982f, 0.016616618f},
        {0.095460490f, 0.888010848f, 0.016528651f},
        {0.110421040f, 0.873140755f, 0.016438193f},
        {0.128430384f, 0.855224817f, 0.016344788f},
        {0.150174712f, 0.833577319f, 0.016247957f},
        {0.176468480f, 0.807384293f, 0.016147214f},
        {0.208235667f, 0.775722345f, 0.016041975f},
        {0.246440024f, 0.737628435f, 0.015931528f},
        {0.291908018f, 0.692276903f, 0.015815065f},
        {0.344984668f, 0.639323614f, 0.015691704f},
        {0.405003302f, 0.579436097f, 0.015560587f},
        {0.469770292f, 0.514808650f, 0.015421044f},
        {0.535622243f, 0.449104730f, 0.015273012f},
        {0.598446474f, 0.386436255f, 0.015117256f},
        {0.655118405f, 0.329926299f, 0.014955281f},
        {0.704188549f, 0.281022574f, 0.014788861f},
        {0.745606932f, 0.239773366f, 0.014619686f},
        {0.780098645f, 0.205452132f, 0.014449208f},
        {0.808669226f, 0.177052183f, 0.014278574f},
        {0.832329195f, 0.153562082f, 0.014108706f},
        {0.851973460f, 0.134086206f, 0.013940317f},
        {0.868355627f, 0.117870335f, 0.013774022f},
        {0.882088371f, 0.104301317f, 0.013610295f},
        {0.893665842f, 0.092884622f, 0.013449518f},
        {0.903484049f, 0.083223919f, 0.013292015f},
        {0.911858005f, 0.075003924f, 0.013138054f},
        {0.919041310f, 0.067970837f, 0.012987836f},
        {0.925236892f, 0.061921566f, 0.012841525f},
        {0.930609071f, 0.056691665f, 0.012699247f},
        {0.935290842f, 0.052148021f, 0.012561120f},
        {0.939390513f, 0.048182279f, 0.012427191f},
        {0.942996767f, 0.044705727f, 0.012297489f},
        {0.946182355f, 0.041645556f, 0.012172072f},
        {0.949008025f, 0.038941093f, 0.012050866f},
        {0.951523919f, 0.036542201f, 0.011933864f},
        {0.953772082f, 0.034406857f, 0.011821045f},
        {0.955787697f, 0.032499914f, 0.011712372f},
        {0.957600446f, 0.030791764f, 0.011607774f},
        {0.959235683f, 0.029257157f, 0.011507144f},
        {0.960714776f, 0.027874770f, 0.011410438f},
        {0.962055945f, 0.026626454f, 0.011317586f},
        {0.963275107f, 0.025496410f, 0.011228468f},
        {0.964300437f, 0.024471080f, 0.011228468f},
        {0.965232800f, 0.023538717f, 0.011228468f},
        {0.966082492f, 0.022689026f, 0.011228468f},
        {0.966858432f, 0.021913087f, 0.011228468f},
        {0.967568415f, 0.021203103f, 0.011228468f},
        {0.968219303f, 0.020552216f, 0.011228468f},
        {0.968817046f, 0.019954474f, 0.011228468f},
        {0.969366905f, 0.019404615f, 0.011228468f},
        {0.969873478f, 0.018898043f, 0.011228468f},
        {0.970340909f, 0.018430612f, 0.011228468f},
        {0.970772869f, 0.017998652f, 0.011228468f},
        {0.971172383f, 0.017599138f, 0.011228468f},
        {0.971542180f, 0.017229342f, 0.011228468f},
        {0.971884776f, 0.016886746f, 0.011228468f},
        {0.972202337f, 0.016569185f, 0.011228468f},
        {0.972496890f, 0.016274633f, 0.011228468f},
        {0.972770257f, 0.016001266f, 0.011228468f},
        {0.973023999f, 0.015747524f, 0.011228468f},
        {0.973259632f, 0.015511892f, 0.011228468f},
        {0.973478536f, 0.015292988f, 0.011228468f},
        {0.973681941f, 0.015089583f, 0.011228468f},
        {0.973870951f, 0.014900573f, 0.011228468f},
        {0.974046776f, 0.014724748f, 0.011228468f},
        {0.974210313f, 0.014561212f, 0.011228468f},
        {0.974362517f, 0.014409008f, 0.011228468f},
        {0.974504245f, 0.014267281f, 0.011228468f},
        {0.974636162f, 0.014135364f, 0.011228468f},
        {0.974759150f, 0.014012377f, 0.011228468f},
        {0.974873710f, 0.013897817f, 0.011228468f},
        {0.974980528f, 0.013790999f, 0.011228468f},
        {0.975080171f, 0.013691356f, 0.011228468f},
        {0.975173072f, 0.013598455f, 0.011228468f},
        {0.975259696f, 0.013511832f, 0.011228468f},
        {0.975340480f, 0.013431048f, 0.011228468f},
        {0.975415806f, 0.013355721f, 0.011228468f},
        {0.975486006f, 0.013285522f, 0.011228468f},
        {0.975551437f, 0.013220092f, 0.011228468f},
        {0.975612438f, 0.013159090f, 0.011228468f},
        {0.975669295f, 0.013102234f, 0.011228468f},
        {0.975722246f, 0.013049283f, 0.011228468f},
        {0.975771580f, 0.012999949f, 0.011228468f},
        {0.975817540f, 0.012953989f, 0.011228468f},
        {0.975860350f, 0.012911179f, 0.011228468f},
        {0.975900220f, 0.012871310f, 0.011228468f},
        {0.975937277f, 0.012834253f, 0.011228468f},
        {0.975971818f, 0.012799711f, 0.011228468f},
        {0.976003931f, 0.012767598f, 0.011228468f},
        {0.976033845f, 0.012737685f, 0.011228468f},
        {0.976061665f, 0.012709865f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f},
        {0.976087481f, 0.012684050f, 0.011228468f}
};

// CIE "physiologically-relevant" luminous efficiency functions consistent with the
// Stockman & Sharpe cone fundamentals; 2-deg at 1nm interval from 390nm to 790nm
//
// Data source:
//     http://www.cvrl.org/lumindex.htm
const size_t CIE_LMSR_COUNT = 401;
const float4 CIE_LMSR[CIE_LMSR_COUNT] = { // NOLINT
        {4.15003E-04f, 3.68349E-04f, 9.54729E-03f, 0.0022090000f},
        {5.02650E-04f, 4.48015E-04f, 1.14794E-02f, 0.0025470000f},
        {6.07367E-04f, 5.43965E-04f, 1.37986E-02f, 0.0029390000f},
        {7.31850E-04f, 6.58983E-04f, 1.65746E-02f, 0.0033940000f},
        {8.79012E-04f, 7.96121E-04f, 1.98869E-02f, 0.0039210000f},
        {1.05192E-03f, 9.58658E-04f, 2.38250E-02f, 0.0045300000f},
        {1.25373E-03f, 1.15002E-03f, 2.84877E-02f, 0.0052400000f},
        {1.48756E-03f, 1.37367E-03f, 3.39832E-02f, 0.0060500000f},
        {1.75633E-03f, 1.63296E-03f, 4.04274E-02f, 0.0069800000f},
        {2.06261E-03f, 1.93089E-03f, 4.79417E-02f, 0.0080600000f},
        {2.40836E-03f, 2.26991E-03f, 5.66498E-02f, 0.0092900000f},
        {2.79522E-03f, 2.65210E-03f, 6.66757E-02f, 0.0107000000f},
        {3.22640E-03f, 3.08110E-03f, 7.81479E-02f, 0.0123100000f},
        {3.70617E-03f, 3.56156E-03f, 9.11925E-02f, 0.0141300000f},
        {4.23972E-03f, 4.09900E-03f, 1.05926E-01f, 0.0161900000f},
        {4.83339E-03f, 4.70010E-03f, 1.22451E-01f, 0.0185200000f},
        {5.49335E-03f, 5.37186E-03f, 1.40844E-01f, 0.0211300000f},
        {6.21933E-03f, 6.11757E-03f, 1.61140E-01f, 0.0240500000f},
        {7.00631E-03f, 6.93795E-03f, 1.83325E-01f, 0.0273000000f},
        {7.84503E-03f, 7.83144E-03f, 2.07327E-01f, 0.0308900000f},
        {8.72127E-03f, 8.79369E-03f, 2.33008E-01f, 0.0348400000f},
        {9.61879E-03f, 9.81865E-03f, 2.60183E-01f, 0.0391600000f},
        {1.05324E-02f, 1.09044E-02f, 2.88723E-01f, 0.0439000000f},
        {1.14620E-02f, 1.20509E-02f, 3.18512E-01f, 0.0490000000f},
        {1.24105E-02f, 1.32582E-02f, 3.49431E-01f, 0.0545000000f},
        {1.33837E-02f, 1.45277E-02f, 3.81363E-01f, 0.0604000000f},
        {1.43870E-02f, 1.58600E-02f, 4.14141E-01f, 0.0668000000f},
        {1.54116E-02f, 1.72496E-02f, 4.47350E-01f, 0.0736000000f},
        {1.64424E-02f, 1.86878E-02f, 4.80439E-01f, 0.0808000000f},
        {1.74614E-02f, 2.01638E-02f, 5.12767E-01f, 0.0885000000f},
        {1.84480E-02f, 2.16649E-02f, 5.43618E-01f, 0.0966000000f},
        {1.93852E-02f, 2.31801E-02f, 5.72399E-01f, 0.1052000000f},
        {2.02811E-02f, 2.47139E-02f, 5.99284E-01f, 0.1141000000f},
        {2.11545E-02f, 2.62785E-02f, 6.24786E-01f, 0.1235000000f},
        {2.20286E-02f, 2.78905E-02f, 6.49576E-01f, 0.1334000000f},
        {2.29317E-02f, 2.95714E-02f, 6.74474E-01f, 0.1436000000f},
        {2.38896E-02f, 3.13438E-02f, 7.00186E-01f, 0.1541000000f},
        {2.49026E-02f, 3.32151E-02f, 7.26460E-01f, 0.1651000000f},
        {2.59631E-02f, 3.51889E-02f, 7.52726E-01f, 0.1764000000f},
        {2.70619E-02f, 3.72683E-02f, 7.78333E-01f, 0.1879000000f},
        {2.81877E-02f, 3.94566E-02f, 8.02555E-01f, 0.1998000000f},
        {2.93303E-02f, 4.17546E-02f, 8.24818E-01f, 0.2119000000f},
        {3.04898E-02f, 4.41544E-02f, 8.45422E-01f, 0.2243000000f},
        {3.16694E-02f, 4.66432E-02f, 8.64961E-01f, 0.2369000000f},
        {3.28731E-02f, 4.92050E-02f, 8.84100E-01f, 0.2496000000f},
        {3.41054E-02f, 5.18199E-02f, 9.03573E-01f, 0.2625000000f},
        {3.53670E-02f, 5.44645E-02f, 9.23844E-01f, 0.2755000000f},
        {3.66400E-02f, 5.71131E-02f, 9.44055E-01f, 0.2886000000f},
        {3.78988E-02f, 5.97369E-02f, 9.62920E-01f, 0.3017000000f},
        {3.91148E-02f, 6.23038E-02f, 9.79057E-01f, 0.3149000000f},
        {4.02563E-02f, 6.47782E-02f, 9.91020E-01f, 0.3281000000f},
        {4.12989E-02f, 6.71329E-02f, 9.97765E-01f, 0.3412000000f},
        {4.22582E-02f, 6.93844E-02f, 9.99982E-01f, 0.3543000000f},
        {4.31627E-02f, 7.15658E-02f, 9.98861E-01f, 0.3673000000f},
        {4.40444E-02f, 7.37164E-02f, 9.95628E-01f, 0.3803000000f},
        {4.49380E-02f, 7.58812E-02f, 9.91515E-01f, 0.3931000000f},
        {4.58729E-02f, 7.80980E-02f, 9.87377E-01f, 0.4060000000f},
        {4.68459E-02f, 8.03538E-02f, 9.82619E-01f, 0.4180000000f},
        {4.78446E-02f, 8.26198E-02f, 9.76301E-01f, 0.4310000000f},
        {4.88555E-02f, 8.48644E-02f, 9.67513E-01f, 0.4430000000f},
        {4.98639E-02f, 8.70524E-02f, 9.55393E-01f, 0.4550000000f},
        {5.08618E-02f, 8.91640E-02f, 9.39499E-01f, 0.4670000000f},
        {5.18731E-02f, 9.12523E-02f, 9.20807E-01f, 0.4790000000f},
        {5.29317E-02f, 9.33950E-02f, 9.00592E-01f, 0.4900000000f},
        {5.40746E-02f, 9.56775E-02f, 8.80040E-01f, 0.5020000000f},
        {5.53418E-02f, 9.81934E-02f, 8.60240E-01f, 0.5130000000f},
        {5.67734E-02f, 1.01031E-01f, 8.42031E-01f, 0.5240000000f},
        {5.83973E-02f, 1.04229E-01f, 8.25572E-01f, 0.5350000000f},
        {6.02409E-02f, 1.07814E-01f, 8.10860E-01f, 0.5460000000f},
        {6.23353E-02f, 1.11817E-01f, 7.97902E-01f, 0.5570000000f},
        {6.47164E-02f, 1.16272E-01f, 7.86704E-01f, 0.5670000000f},
        {6.74131E-02f, 1.21204E-01f, 7.77119E-01f, 0.5780000000f},
        {7.04040E-02f, 1.26573E-01f, 7.68365E-01f, 0.5880000000f},
        {7.36489E-02f, 1.32311E-01f, 7.59538E-01f, 0.5990000000f},
        {7.70978E-02f, 1.38334E-01f, 7.49777E-01f, 0.6100000000f},
        {8.06894E-02f, 1.44541E-01f, 7.38268E-01f, 0.6200000000f},
        {8.43613E-02f, 1.50828E-01f, 7.24389E-01f, 0.6310000000f},
        {8.80904E-02f, 1.57146E-01f, 7.08113E-01f, 0.6420000000f},
        {9.18630E-02f, 1.63457E-01f, 6.89572E-01f, 0.6530000000f},
        {9.56637E-02f, 1.69721E-01f, 6.68927E-01f, 0.6640000000f},
        {9.94755E-02f, 1.75893E-01f, 6.46359E-01f, 0.6760000000f},
        {1.03286E-01f, 1.81938E-01f, 6.22112E-01f, 0.6870000000f},
        {1.07103E-01f, 1.87872E-01f, 5.96591E-01f, 0.6990000000f},
        {1.10947E-01f, 1.93731E-01f, 5.70216E-01f, 0.7100000000f},
        {1.14838E-01f, 1.99557E-01f, 5.43373E-01f, 0.7220000000f},
        {1.18802E-01f, 2.05398E-01f, 5.16411E-01f, 0.7340000000f},
        {1.22863E-01f, 2.11302E-01f, 4.89647E-01f, 0.7450000000f},
        {1.27026E-01f, 2.17283E-01f, 4.63406E-01f, 0.7570000000f},
        {1.31293E-01f, 2.23347E-01f, 4.37965E-01f, 0.7690000000f},
        {1.35666E-01f, 2.29501E-01f, 4.13549E-01f, 0.7810000000f},
        {1.40145E-01f, 2.35754E-01f, 3.90333E-01f, 0.7930000000f},
        {1.44731E-01f, 2.42108E-01f, 3.68394E-01f, 0.8050000000f},
        {1.49415E-01f, 2.48545E-01f, 3.47582E-01f, 0.8170000000f},
        {1.54189E-01f, 2.55037E-01f, 3.27724E-01f, 0.8280000000f},
        {1.59038E-01f, 2.61554E-01f, 3.08676E-01f, 0.8400000000f},
        {1.63952E-01f, 2.68063E-01f, 2.90322E-01f, 0.8510000000f},
        {1.68932E-01f, 2.74561E-01f, 2.72626E-01f, 0.8620000000f},
        {1.74063E-01f, 2.81180E-01f, 2.55772E-01f, 0.8730000000f},
        {1.79457E-01f, 2.88097E-01f, 2.39945E-01f, 0.8840000000f},
        {1.85241E-01f, 2.95508E-01f, 2.25280E-01f, 0.8940000000f},
        {1.91556E-01f, 3.03630E-01f, 2.11867E-01f, 0.9040000000f},
        {1.98532E-01f, 3.12649E-01f, 1.99719E-01f, 0.9140000000f},
        {2.06182E-01f, 3.22565E-01f, 1.88674E-01f, 0.9230000000f},
        {2.14485E-01f, 3.33319E-01f, 1.78557E-01f, 0.9320000000f},
        {2.23411E-01f, 3.44844E-01f, 1.69217E-01f, 0.9410000000f},
        {2.32926E-01f, 3.57061E-01f, 1.60526E-01f, 0.9490000000f},
        {2.42992E-01f, 3.69895E-01f, 1.52368E-01f, 0.9570000000f},
        {2.53616E-01f, 3.83355E-01f, 1.44620E-01f, 0.9640000000f},
        {2.64810E-01f, 3.97467E-01f, 1.37173E-01f, 0.9700000000f},
        {2.76587E-01f, 4.12260E-01f, 1.29937E-01f, 0.9760000000f},
        {2.88959E-01f, 4.27764E-01f, 1.22839E-01f, 0.9820000000f},
        {3.01934E-01f, 4.44001E-01f, 1.15834E-01f, 0.9860000000f},
        {3.15508E-01f, 4.60947E-01f, 1.08922E-01f, 0.9900000000f},
        {3.29673E-01f, 4.78562E-01f, 1.02118E-01f, 0.9940000000f},
        {3.44416E-01f, 4.96795E-01f, 9.54374E-02f, 0.9970000000f},
        {3.59716E-01f, 5.15587E-01f, 8.88965E-02f, 0.9980000000f},
        {3.75550E-01f, 5.34868E-01f, 8.25343E-02f, 1.0000000000f},
        {3.91895E-01f, 5.54575E-01f, 7.64613E-02f, 1.0000000000f},
        {4.08722E-01f, 5.74640E-01f, 7.07769E-02f, 1.0000000000f},
        {4.25998E-01f, 5.94984E-01f, 6.55491E-02f, 0.9980000000f},
        {4.43683E-01f, 6.15520E-01f, 6.08210E-02f, 0.9970000000f},
        {4.61731E-01f, 6.36162E-01f, 5.65919E-02f, 0.9940000000f},
        {4.80094E-01f, 6.56872E-01f, 5.27659E-02f, 0.9900000000f},
        {4.98717E-01f, 6.77624E-01f, 4.92440E-02f, 0.9860000000f},
        {5.17539E-01f, 6.98393E-01f, 4.59470E-02f, 0.9810000000f},
        {5.36494E-01f, 7.19154E-01f, 4.28123E-02f, 0.9750000000f},
        {5.55493E-01f, 7.39844E-01f, 3.98014E-02f, 0.9680000000f},
        {5.74386E-01f, 7.60235E-01f, 3.69227E-02f, 0.9610000000f},
        {5.92995E-01f, 7.80039E-01f, 3.41909E-02f, 0.9530000000f},
        {6.11124E-01f, 7.98941E-01f, 3.16158E-02f, 0.9440000000f},
        {6.28561E-01f, 8.16610E-01f, 2.92033E-02f, 0.9350000000f},
        {6.45139E-01f, 8.32783E-01f, 2.69536E-02f, 0.9250000000f},
        {6.60907E-01f, 8.47550E-01f, 2.48575E-02f, 0.9150000000f},
        {6.75993E-01f, 8.61113E-01f, 2.29047E-02f, 0.9040000000f},
        {6.90542E-01f, 8.73698E-01f, 2.10855E-02f, 0.8920000000f},
        {7.04720E-01f, 8.85550E-01f, 1.93912E-02f, 0.8800000000f},
        {7.18662E-01f, 8.96873E-01f, 1.78145E-02f, 0.8670000000f},
        {7.32323E-01f, 9.07638E-01f, 1.63514E-02f, 0.8540000000f},
        {7.45606E-01f, 9.17757E-01f, 1.49980E-02f, 0.8400000000f},
        {7.58410E-01f, 9.27137E-01f, 1.37497E-02f, 0.8260000000f},
        {7.70630E-01f, 9.35687E-01f, 1.26013E-02f, 0.8110000000f},
        {7.82208E-01f, 9.43362E-01f, 1.15466E-02f, 0.7960000000f},
        {7.93290E-01f, 9.50309E-01f, 1.05766E-02f, 0.7810000000f},
        {8.04084E-01f, 9.56733E-01f, 9.68268E-03f, 0.7650000000f},
        {8.14813E-01f, 9.62844E-01f, 8.85746E-03f, 0.7490000000f},
        {8.25711E-01f, 9.68858E-01f, 8.09453E-03f, 0.7330000000f},
        {8.36943E-01f, 9.74919E-01f, 7.38890E-03f, 0.7170000000f},
        {8.48349E-01f, 9.80850E-01f, 6.73799E-03f, 0.7000000000f},
        {8.59676E-01f, 9.86388E-01f, 6.13947E-03f, 0.6830000000f},
        {8.70656E-01f, 9.91267E-01f, 5.59073E-03f, 0.6670000000f},
        {8.81011E-01f, 9.95217E-01f, 5.08900E-03f, 0.6500000000f},
        {8.90496E-01f, 9.98007E-01f, 4.63120E-03f, 0.6330000000f},
        {8.99052E-01f, 9.99595E-01f, 4.21366E-03f, 0.6160000000f},
        {9.06669E-01f, 9.99982E-01f, 3.83286E-03f, 0.5990000000f},
        {9.13341E-01f, 9.99177E-01f, 3.48559E-03f, 0.5810000000f},
        {9.19067E-01f, 9.97193E-01f, 3.16893E-03f, 0.5640000000f},
        {9.23898E-01f, 9.94102E-01f, 2.88021E-03f, 0.5480000000f},
        {9.28099E-01f, 9.90204E-01f, 2.61698E-03f, 0.5310000000f},
        {9.31995E-01f, 9.85855E-01f, 2.37701E-03f, 0.5140000000f},
        {9.35916E-01f, 9.81404E-01f, 2.15829E-03f, 0.4970000000f},
        {9.40198E-01f, 9.77193E-01f, 1.95896E-03f, 0.4810000000f},
        {9.45076E-01f, 9.73441E-01f, 1.77737E-03f, 0.4650000000f},
        {9.50367E-01f, 9.69881E-01f, 1.61218E-03f, 0.4480000000f},
        {9.55775E-01f, 9.66133E-01f, 1.46215E-03f, 0.4330000000f},
        {9.61000E-01f, 9.61823E-01f, 1.32606E-03f, 0.4170000000f},
        {9.65733E-01f, 9.56583E-01f, 1.20277E-03f, 0.4020000000f},
        {9.69744E-01f, 9.50167E-01f, 1.09118E-03f, 0.3864000000f},
        {9.73133E-01f, 9.42773E-01f, 9.90135E-04f, 0.3715000000f},
        {9.76086E-01f, 9.34709E-01f, 8.98564E-04f, 0.3569000000f},
        {9.78793E-01f, 9.26271E-01f, 8.15524E-04f, 0.3427000000f},
        {9.81445E-01f, 9.17750E-01f, 7.40174E-04f, 0.3288000000f},
        {9.84186E-01f, 9.09339E-01f, 6.71772E-04f, 0.3151000000f},
        {9.86965E-01f, 9.00895E-01f, 6.09693E-04f, 0.3018000000f},
        {9.89678E-01f, 8.92197E-01f, 5.53372E-04f, 0.2888000000f},
        {9.92220E-01f, 8.83035E-01f, 5.02292E-04f, 0.2762000000f},
        {9.94486E-01f, 8.73205E-01f, 4.55979E-04f, 0.2639000000f},
        {9.96386E-01f, 8.62565E-01f, 4.13997E-04f, 0.2519000000f},
        {9.97895E-01f, 8.51173E-01f, 3.75940E-04f, 0.2403000000f},
        {9.99004E-01f, 8.39132E-01f, 3.41439E-04f, 0.2291000000f},
        {9.99706E-01f, 8.26545E-01f, 3.10160E-04f, 0.2182000000f},
        {9.99993E-01f, 8.13509E-01f, 2.81800E-04f, 0.2076000000f},
        {9.99837E-01f, 8.00082E-01f, 2.56084E-04f, 0.1974000000f},
        {9.99123E-01f, 7.86166E-01f, 2.32764E-04f, 0.1876000000f},
        {9.97719E-01f, 7.71635E-01f, 2.11616E-04f, 0.1782000000f},
        {9.95491E-01f, 7.56376E-01f, 1.92436E-04f, 0.1690000000f},
        {9.92310E-01f, 7.40291E-01f, 1.75039E-04f, 0.1602000000f},
        {9.88146E-01f, 7.23369E-01f, 1.59257E-04f, 0.1517000000f},
        {9.83345E-01f, 7.05890E-01f, 1.44940E-04f, 0.1436000000f},
        {9.78342E-01f, 6.88184E-01f, 1.31948E-04f, 0.1358000000f},
        {9.73564E-01f, 6.70554E-01f, 1.20157E-04f, 0.1284000000f},
        {9.69429E-01f, 6.53274E-01f, 1.09454E-04f, 0.1212000000f},
        {9.66211E-01f, 6.36524E-01f, 9.97367E-05f, 0.1143000000f},
        {9.63630E-01f, 6.20217E-01f, 9.09125E-05f, 0.1078000000f},
        {9.61273E-01f, 6.04211E-01f, 8.28976E-05f, 0.1015000000f},
        {9.58732E-01f, 5.88375E-01f, 7.56160E-05f, 0.0956000000f},
        {9.55602E-01f, 5.72597E-01f, 6.89991E-05f, 0.0899000000f},
        {9.51569E-01f, 5.56783E-01f, 6.29846E-05f, 0.0845000000f},
        {9.46654E-01f, 5.40896E-01f, 5.75163E-05f, 0.0793000000f},
        {9.40962E-01f, 5.24912E-01f, 5.25432E-05f, 0.0745000000f},
        {9.34600E-01f, 5.08817E-01f, 4.80192E-05f, 0.0699000000f},
        {9.27673E-01f, 4.92599E-01f, 4.39024E-05f, 0.0655000000f},
        {9.20264E-01f, 4.76268E-01f, 4.01551E-05f, 0.0613000000f},
        {9.12391E-01f, 4.59893E-01f, 3.67431E-05f, 0.0574000000f},
        {9.04050E-01f, 4.43551E-01f, 3.36353E-05f, 0.0537000000f},
        {8.95243E-01f, 4.27314E-01f, 3.08037E-05f, 0.0502000000f},
        {8.85969E-01f, 4.11246E-01f, 2.82228E-05f, 0.0469000000f},
        {8.76242E-01f, 3.95396E-01f, 2.58697E-05f, 0.0438000000f},
        {8.66117E-01f, 3.79782E-01f, 2.37235E-05f, 0.0409000000f},
        {8.55658E-01f, 3.64410E-01f, 2.17653E-05f, 0.0381600000f},
        {8.44926E-01f, 3.49289E-01f, 1.99779E-05f, 0.0355800000f},
        {8.33982E-01f, 3.34429E-01f, 1.83459E-05f, 0.0331500000f},
        {8.22859E-01f, 3.19843E-01f, 1.68551E-05f, 0.0308700000f},
        {8.11491E-01f, 3.05564E-01f, 1.54929E-05f, 0.0287400000f},
        {7.99794E-01f, 2.91625E-01f, 1.42476E-05f, 0.0267400000f},
        {7.87689E-01f, 2.78053E-01f, 1.31087E-05f, 0.0248700000f},
        {7.75103E-01f, 2.64872E-01f, 1.20667E-05f, 0.0231200000f},
        {7.61996E-01f, 2.52099E-01f, 1.11131E-05f, 0.0214700000f},
        {7.48425E-01f, 2.39747E-01f, 1.02399E-05f, 0.0199400000f},
        {7.34470E-01f, 2.27822E-01f, 9.43999E-06f, 0.0185100000f},
        {7.20208E-01f, 2.16330E-01f, 8.70695E-06f, 0.0171800000f},
        {7.05713E-01f, 2.05273E-01f, 8.03488E-06f, 0.0159300000f},
        {6.91044E-01f, 1.94650E-01f, 7.41844E-06f, 0.0147700000f},
        {6.76212E-01f, 1.84448E-01f, 6.85279E-06f, 0.0136900000f},
        {6.61220E-01f, 1.74654E-01f, 6.33352E-06f, 0.0126900000f},
        {6.46072E-01f, 1.65256E-01f, 5.85662E-06f, 0.0117500000f},
        {6.30773E-01f, 1.56243E-01f, 5.41843E-06f, 0.0108800000f},
        {6.15349E-01f, 1.47602E-01f, 0.00000E+00f, 0.0100700000f},
        {5.99888E-01f, 1.39329E-01f, 0.00000E+00f, 0.0093200000f},
        {5.84489E-01f, 1.31416E-01f, 0.00000E+00f, 0.0086200000f},
        {5.69240E-01f, 1.23856E-01f, 0.00000E+00f, 0.0079700000f},
        {5.54224E-01f, 1.16641E-01f, 0.00000E+00f, 0.0073700000f},
        {5.39469E-01f, 1.09766E-01f, 0.00000E+00f, 0.0068200000f},
        {5.24827E-01f, 1.03226E-01f, 0.00000E+00f, 0.0063000000f},
        {5.10124E-01f, 9.70205E-02f, 0.00000E+00f, 0.0058200000f},
        {4.95206E-01f, 9.11430E-02f, 0.00000E+00f, 0.0053800000f},
        {4.79941E-01f, 8.55872E-02f, 0.00000E+00f, 0.0049700000f},
        {4.64270E-01f, 8.03428E-02f, 0.00000E+00f, 0.0045900000f},
        {4.48338E-01f, 7.53913E-02f, 0.00000E+00f, 0.0042400000f},
        {4.32329E-01f, 7.07136E-02f, 0.00000E+00f, 0.0039130000f},
        {4.16406E-01f, 6.62924E-02f, 0.00000E+00f, 0.0036130000f},
        {4.00711E-01f, 6.21120E-02f, 0.00000E+00f, 0.0033350000f},
        {3.85355E-01f, 5.81595E-02f, 0.00000E+00f, 0.0030790000f},
        {3.70377E-01f, 5.44276E-02f, 0.00000E+00f, 0.0028420000f},
        {3.55793E-01f, 5.09098E-02f, 0.00000E+00f, 0.0026230000f},
        {3.41618E-01f, 4.75991E-02f, 0.00000E+00f, 0.0024210000f},
        {3.27864E-01f, 4.44879E-02f, 0.00000E+00f, 0.0022350000f},
        {3.14541E-01f, 4.15659E-02f, 0.00000E+00f, 0.0020620000f},
        {3.01662E-01f, 3.88152E-02f, 0.00000E+00f, 0.0019030000f},
        {2.89239E-01f, 3.62181E-02f, 0.00000E+00f, 0.0017570000f},
        {2.77278E-01f, 3.37599E-02f, 0.00000E+00f, 0.0016210000f},
        {2.65784E-01f, 3.14282E-02f, 0.00000E+00f, 0.0014970000f},
        {2.54740E-01f, 2.92176E-02f, 0.00000E+00f, 0.0013820000f},
        {2.44054E-01f, 2.71403E-02f, 0.00000E+00f, 0.0012760000f},
        {2.33634E-01f, 2.52084E-02f, 0.00000E+00f, 0.0011780000f},
        {2.23399E-01f, 2.34286E-02f, 0.00000E+00f, 0.0010880000f},
        {2.13284E-01f, 2.18037E-02f, 0.00000E+00f, 0.0010050000f},
        {2.03257E-01f, 2.03285E-02f, 0.00000E+00f, 0.0009280000f},
        {1.93370E-01f, 1.89779E-02f, 0.00000E+00f, 0.0008570000f},
        {1.83688E-01f, 1.77272E-02f, 0.00000E+00f, 0.0007920000f},
        {1.74263E-01f, 1.65560E-02f, 0.00000E+00f, 0.0007320000f},
        {1.65141E-01f, 1.54480E-02f, 0.00000E+00f, 0.0006770000f},
        {1.56354E-01f, 1.43924E-02f, 0.00000E+00f, 0.0006260000f},
        {1.47916E-01f, 1.33896E-02f, 0.00000E+00f, 0.0005790000f},
        {1.39834E-01f, 1.24414E-02f, 0.00000E+00f, 0.0005360000f},
        {1.32111E-01f, 1.15488E-02f, 0.00000E+00f, 0.0004960000f},
        {1.24749E-01f, 1.07120E-02f, 0.00000E+00f, 0.0004590000f},
        {1.17744E-01f, 9.92994E-03f, 0.00000E+00f, 0.0004250000f},
        {1.11081E-01f, 9.20057E-03f, 0.00000E+00f, 0.0003935000f},
        {1.04747E-01f, 8.52126E-03f, 0.00000E+00f, 0.0003645000f},
        {9.87277E-02f, 7.88945E-03f, 0.00000E+00f, 0.0003377000f},
        {9.30085E-02f, 7.30255E-03f, 0.00000E+00f, 0.0003129000f},
        {8.75769E-02f, 6.75820E-03f, 0.00000E+00f, 0.0002901000f},
        {8.24219E-02f, 6.25474E-03f, 0.00000E+00f, 0.0002689000f},
        {7.75328E-02f, 5.79045E-03f, 0.00000E+00f, 0.0002493000f},
        {7.28989E-02f, 5.36347E-03f, 0.00000E+00f, 0.0002313000f},
        {6.85100E-02f, 4.97179E-03f, 0.00000E+00f, 0.0002146000f},
        {6.43554E-02f, 4.61300E-03f, 0.00000E+00f, 0.0001991000f},
        {6.04242E-02f, 4.28339E-03f, 0.00000E+00f, 0.0001848000f},
        {5.67057E-02f, 3.97940E-03f, 0.00000E+00f, 0.0001716000f},
        {5.31896E-02f, 3.69803E-03f, 0.00000E+00f, 0.0001593000f},
        {4.98661E-02f, 3.43667E-03f, 0.00000E+00f, 0.0001480000f},
        {4.67258E-02f, 3.19326E-03f, 0.00000E+00f, 0.0001375000f},
        {4.37598E-02f, 2.96653E-03f, 0.00000E+00f, 0.0001277000f},
        {4.09594E-02f, 2.75543E-03f, 0.00000E+00f, 0.0001187000f},
        {3.83165E-02f, 2.55896E-03f, 0.00000E+00f, 0.0001104000f},
        {3.58233E-02f, 2.37617E-03f, 0.00000E+00f, 0.0001026000f},
        {3.34725E-02f, 2.20618E-03f, 0.00000E+00f, 0.0000954000f},
        {3.12583E-02f, 2.04809E-03f, 0.00000E+00f, 0.0000888000f},
        {2.91751E-02f, 1.90110E-03f, 0.00000E+00f, 0.0000826000f},
        {2.72173E-02f, 1.76442E-03f, 0.00000E+00f, 0.0000769000f},
        {2.53790E-02f, 1.63734E-03f, 0.00000E+00f, 0.0000715000f},
        {2.36541E-02f, 1.51916E-03f, 0.00000E+00f, 0.0000666000f},
        {2.20336E-02f, 1.40913E-03f, 0.00000E+00f, 0.0000620000f},
        {2.05092E-02f, 1.30655E-03f, 0.00000E+00f, 0.0000578000f},
        {1.90735E-02f, 1.21078E-03f, 0.00000E+00f, 0.0000538000f},
        {1.77201E-02f, 1.12128E-03f, 0.00000E+00f, 0.0000501000f},
        {1.64451E-02f, 1.03766E-03f, 0.00000E+00f, 0.0000467000f},
        {1.52510E-02f, 9.59892E-04f, 0.00000E+00f, 0.0000436000f},
        {1.41404E-02f, 8.87951E-04f, 0.00000E+00f, 0.0000406000f},
        {1.31137E-02f, 8.21729E-04f, 0.00000E+00f, 0.0000378900f},
        {1.21701E-02f, 7.61051E-04f, 0.00000E+00f, 0.0000353300f},
        {1.13063E-02f, 7.05623E-04f, 0.00000E+00f, 0.0000329500f},
        {1.05131E-02f, 6.54874E-04f, 0.00000E+00f, 0.0000307500f},
        {9.78127E-03f, 6.08240E-04f, 0.00000E+00f, 0.0000287000f},
        {9.10300E-03f, 5.65240E-04f, 0.00000E+00f, 0.0000267900f},
        {8.47170E-03f, 5.25457E-04f, 0.00000E+00f, 0.0000250100f},
        {7.88227E-03f, 4.88550E-04f, 0.00000E+00f, 0.0000233600f},
        {7.33213E-03f, 4.54277E-04f, 0.00000E+00f, 0.0000218200f},
        {6.81928E-03f, 4.22436E-04f, 0.00000E+00f, 0.0000203800f},
        {6.34173E-03f, 3.92839E-04f, 0.00000E+00f, 0.0000190500f},
        {5.89749E-03f, 3.65317E-04f, 0.00000E+00f, 0.0000178000f},
        {5.48444E-03f, 3.39710E-04f, 0.00000E+00f, 0.0000166400f},
        {5.09978E-03f, 3.15856E-04f, 0.00000E+00f, 0.0000155600f},
        {4.74086E-03f, 2.93607E-04f, 0.00000E+00f, 0.0000145400f},
        {4.40538E-03f, 2.72834E-04f, 0.00000E+00f, 0.0000136000f},
        {4.09129E-03f, 2.53417E-04f, 0.00000E+00f, 0.0000127300f},
        {3.79703E-03f, 2.35265E-04f, 0.00000E+00f, 0.0000119100f},
        {3.52187E-03f, 2.18331E-04f, 0.00000E+00f, 0.0000111400f},
        {3.26520E-03f, 2.02574E-04f, 0.00000E+00f, 0.0000104300f},
        {3.02632E-03f, 1.87948E-04f, 0.00000E+00f, 0.0000097600f},
        {2.80447E-03f, 1.74402E-04f, 0.00000E+00f, 0.0000091400f},
        {2.59882E-03f, 1.61878E-04f, 0.00000E+00f, 0.0000085600f},
        {2.40849E-03f, 1.50305E-04f, 0.00000E+00f, 0.0000080200f},
        {2.23259E-03f, 1.39612E-04f, 0.00000E+00f, 0.0000075100f},
        {2.07024E-03f, 1.29734E-04f, 0.00000E+00f, 0.0000070400f},
        {1.92058E-03f, 1.20608E-04f, 0.00000E+00f, 0.0000066000f},
        {1.78269E-03f, 1.12176E-04f, 0.00000E+00f, 0.0000061800f},
        {1.65540E-03f, 1.04373E-04f, 0.00000E+00f, 0.0000058000f},
        {1.53762E-03f, 9.71383E-05f, 0.00000E+00f, 0.0000054400f},
        {1.42839E-03f, 9.04202E-05f, 0.00000E+00f, 0.0000051000f},
        {1.32687E-03f, 8.41716E-05f, 0.00000E+00f, 0.0000047800f},
        {1.23238E-03f, 7.83538E-05f, 0.00000E+00f, 0.0000044900f},
        {1.14456E-03f, 7.29425E-05f, 0.00000E+00f, 0.0000042100f},
        {1.06308E-03f, 6.79164E-05f, 0.00000E+00f, 0.0000039510f},
        {9.87592E-04f, 6.32542E-05f, 0.00000E+00f, 0.0000037090f},
        {9.17777E-04f, 5.89349E-05f, 0.00000E+00f, 0.0000034820f},
        {8.53264E-04f, 5.49360E-05f, 0.00000E+00f, 0.0000032700f},
        {7.93589E-04f, 5.12291E-05f, 0.00000E+00f, 0.0000030700f},
        {7.38306E-04f, 4.77872E-05f, 0.00000E+00f, 0.0000028840f},
        {6.87018E-04f, 4.45862E-05f, 0.00000E+00f, 0.0000027100f},
        {6.39373E-04f, 4.16049E-05f, 0.00000E+00f, 0.0000025460f},
        {5.95057E-04f, 3.88245E-05f, 0.00000E+00f, 0.0000023930f},
        {5.53797E-04f, 3.62302E-05f, 0.00000E+00f, 0.0000022500f},
        {5.15350E-04f, 3.38086E-05f, 0.00000E+00f, 0.0000021150f},
        {4.79496E-04f, 3.15474E-05f, 0.00000E+00f, 0.0000019890f},
        {4.46035E-04f, 2.94354E-05f, 0.00000E+00f, 0.0000018700f},
        {4.14809E-04f, 2.74634E-05f, 0.00000E+00f, 0.0000017590f},
        {3.85749E-04f, 2.56268E-05f, 0.00000E+00f, 0.0000016550f},
        {3.58792E-04f, 2.39217E-05f, 0.00000E+00f, 0.0000015570f},
        {3.33861E-04f, 2.23432E-05f, 0.00000E+00f, 0.0000014660f},
        {3.10869E-04f, 2.08860E-05f, 0.00000E+00f, 0.0000013790f},
        {2.89699E-04f, 1.95424E-05f, 0.00000E+00f, 0.0000012990f},
        {2.70145E-04f, 1.82990E-05f, 0.00000E+00f, 0.0000012230f},
        {2.52007E-04f, 1.71423E-05f, 0.00000E+00f, 0.0000011510f},
        {2.35117E-04f, 1.60611E-05f, 0.00000E+00f, 0.0000010840f},
        {2.19329E-04f, 1.50458E-05f, 0.00000E+00f, 0.0000010220f},
        {2.04535E-04f, 1.40893E-05f, 0.00000E+00f, 0.0000009620f},
        {1.90692E-04f, 1.31899E-05f, 0.00000E+00f, 0.0000009070f},
        {1.77771E-04f, 1.23462E-05f, 0.00000E+00f, 0.0000008550f},
        {1.65736E-04f, 1.15569E-05f, 0.00000E+00f, 0.0000008060f},
        {1.54549E-04f, 1.08200E-05f, 0.00000E+00f, 0.0000007600f},
        {1.44167E-04f, 1.01334E-05f, 0.00000E+00f, 0.0000007160f},
        {1.34528E-04f, 9.49367E-06f, 0.00000E+00f, 0.0000006750f},
        {1.25574E-04f, 8.89736E-06f, 0.00000E+00f, 0.0000006370f},
        {1.17251E-04f, 8.34135E-06f, 0.00000E+00f, 0.0000006010f},
        {1.09508E-04f, 7.82271E-06f, 0.00000E+00f, 0.0000005670f},
        {1.02300E-04f, 7.33865E-06f, 0.00000E+00f, 0.0000005350f},
        {9.55828E-05f, 6.88612E-06f, 0.00000E+00f, 0.0000005050f},
        {8.93161E-05f, 6.46228E-06f, 0.00000E+00f, 0.0000004770f},
        {8.34631E-05f, 6.06462E-06f, 0.00000E+00f, 0.0000004500f},
        {7.79912E-05f, 5.69093E-06f, 0.00000E+00f, 0.0000004250f},
        {7.28730E-05f, 5.33942E-06f, 0.00000E+00f, 0.0000004010f},
        {6.80921E-05f, 5.00929E-06f, 0.00000E+00f, 0.0000003790f},
        {6.36342E-05f, 4.69984E-06f, 0.00000E+00f, 0.0000003580f},
        {5.94841E-05f, 4.41034E-06f, 0.00000E+00f, 0.0000003382f},
        {5.56264E-05f, 4.13998E-06f, 0.00000E+00f, 0.0000003196f},
        {5.20430E-05f, 3.88772E-06f, 0.00000E+00f, 0.0000003021f},
        {4.87063E-05f, 3.65186E-06f, 0.00000E+00f, 0.0000002855f},
        {4.55900E-05f, 3.43070E-06f, 0.00000E+00f, 0.0000002699f},
        {4.26710E-05f, 3.22278E-06f, 0.00000E+00f, 0.0000002552f},
        {3.99295E-05f, 3.02683E-06f, 0.00000E+00f, 0.0000002413f},
        {3.73509E-05f, 2.84192E-06f, 0.00000E+00f, 0.0000002282f},
        {3.49326E-05f, 2.66795E-06f, 0.00000E+00f, 0.0000002159f},
        {3.26730E-05f, 2.50491E-06f, 0.00000E+00f, 0.0000002042f},
        {3.05690E-05f, 2.35267E-06f, 0.00000E+00f, 0.0000001932f},
        {2.86163E-05f, 2.21100E-06f, 0.00000E+00f, 0.0000001829f},
        {2.68077E-05f, 2.07946E-06f, 0.00000E+00f, 0.0000001731f},
        {2.51286E-05f, 1.95700E-06f, 0.00000E+00f, 0.0000001638f},
        {2.35645E-05f, 1.84258E-06f, 0.00000E+00f, 0.0000001551f},
        {2.21026E-05f, 1.73528E-06f, 0.00000E+00f, 0.0000001468f},
        {2.07321E-05f, 1.63433E-06f, 0.00000E+00f, 0.0000001390f}
};

// CIE Standard Illuminant D65 relative spectral power distribution,
// from 390nm to 790nm, at 1nm intervals
//
// Data source:
//     https://en.wikipedia.org/wiki/Illuminant_D65
//     https://www.rit.edu/cos/colorscience/rc_useful_data.php
const size_t CIE_D65_INTERVAL = 1;
const size_t CIE_D65_START = 390;
const size_t CIE_D65_END = 790;
const size_t CIE_D65_COUNT = 401;
const float CIE_D65[CIE_D65_COUNT] = {
        54.6482f,
        57.4589f,
        60.2695f,
        63.0802f,
        65.8909f,
        68.7015f,
        71.5122f,
        74.3229f,
        77.1336f,
        79.9442f,
        82.7549f,
        83.628f,
        84.5011f,
        85.3742f,
        86.2473f,
        87.1204f,
        87.9936f,
        88.8667f,
        89.7398f,
        90.6129f,
        91.486f,
        91.6806f,
        91.8752f,
        92.0697f,
        92.2643f,
        92.4589f,
        92.6535f,
        92.8481f,
        93.0426f,
        93.2372f,
        93.4318f,
        92.7568f,
        92.0819f,
        91.4069f,
        90.732f,
        90.057f,
        89.3821f,
        88.7071f,
        88.0322f,
        87.3572f,
        86.6823f,
        88.5006f,
        90.3188f,
        92.1371f,
        93.9554f,
        95.7736f,
        97.5919f,
        99.4102f,
        101.228f,
        103.047f,
        104.865f,
        106.079f,
        107.294f,
        108.508f,
        109.722f,
        110.936f,
        112.151f,
        113.365f,
        114.579f,
        115.794f,
        117.008f,
        117.088f,
        117.169f,
        117.249f,
        117.33f,
        117.41f,
        117.49f,
        117.571f,
        117.651f,
        117.732f,
        117.812f,
        117.517f,
        117.222f,
        116.927f,
        116.632f,
        116.336f,
        116.041f,
        115.746f,
        115.451f,
        115.156f,
        114.861f,
        114.967f,
        115.073f,
        115.18f,
        115.286f,
        115.392f,
        115.498f,
        115.604f,
        115.711f,
        115.817f,
        115.923f,
        115.212f,
        114.501f,
        113.789f,
        113.078f,
        112.367f,
        111.656f,
        110.945f,
        110.233f,
        109.522f,
        108.811f,
        108.865f,
        108.92f,
        108.974f,
        109.028f,
        109.082f,
        109.137f,
        109.191f,
        109.245f,
        109.3f,
        109.354f,
        109.199f,
        109.044f,
        108.888f,
        108.733f,
        108.578f,
        108.423f,
        108.268f,
        108.112f,
        107.957f,
        107.802f,
        107.501f,
        107.2f,
        106.898f,
        106.597f,
        106.296f,
        105.995f,
        105.694f,
        105.392f,
        105.091f,
        104.79f,
        105.08f,
        105.37f,
        105.66f,
        105.95f,
        106.239f,
        106.529f,
        106.819f,
        107.109f,
        107.399f,
        107.689f,
        107.361f,
        107.032f,
        106.704f,
        106.375f,
        106.047f,
        105.719f,
        105.39f,
        105.062f,
        104.733f,
        104.405f,
        104.369f,
        104.333f,
        104.297f,
        104.261f,
        104.225f,
        104.19f,
        104.154f,
        104.118f,
        104.082f,
        104.046f,
        103.641f,
        103.237f,
        102.832f,
        102.428f,
        102.023f,
        101.618f,
        101.214f,
        100.809f,
        100.405f,
        100.0f,
        99.6334f,
        99.2668f,
        98.9003f,
        98.5337f,
        98.1671f,
        97.8005f,
        97.4339f,
        97.0674f,
        96.7008f,
        96.3342f,
        96.2796f,
        96.225f,
        96.1703f,
        96.1157f,
        96.0611f,
        96.0065f,
        95.9519f,
        95.8972f,
        95.8426f,
        95.788f,
        95.0778f,
        94.3675f,
        93.6573f,
        92.947f,
        92.2368f,
        91.5266f,
        90.8163f,
        90.1061f,
        89.3958f,
        88.6856f,
        88.8177f,
        88.9497f,
        89.0818f,
        89.2138f,
        89.3459f,
        89.478f,
        89.61f,
        89.7421f,
        89.8741f,
        90.0062f,
        89.9655f,
        89.9248f,
        89.8841f,
        89.8434f,
        89.8026f,
        89.7619f,
        89.7212f,
        89.6805f,
        89.6398f,
        89.5991f,
        89.4091f,
        89.219f,
        89.029f,
        88.8389f,
        88.6489f,
        88.4589f,
        88.2688f,
        88.0788f,
        87.8887f,
        87.6987f,
        87.2577f,
        86.8167f,
        86.3757f,
        85.9347f,
        85.4936f,
        85.0526f,
        84.6116f,
        84.1706f,
        83.7296f,
        83.2886f,
        83.3297f,
        83.3707f,
        83.4118f,
        83.4528f,
        83.4939f,
        83.535f,
        83.576f,
        83.6171f,
        83.6581f,
        83.6992f,
        83.332f,
        82.9647f,
        82.5975f,
        82.2302f,
        81.863f,
        81.4958f,
        81.1285f,
        80.7613f,
        80.394f,
        80.0268f,
        80.0456f,
        80.0644f,
        80.0831f,
        80.1019f,
        80.1207f,
        80.1395f,
        80.1583f,
        80.177f,
        80.1958f,
        80.2146f,
        80.4209f,
        80.6272f,
        80.8336f,
        81.0399f,
        81.2462f,
        81.4525f,
        81.6588f,
        81.8652f,
        82.0715f,
        82.2778f,
        81.8784f,
        81.4791f,
        81.0797f,
        80.6804f,
        80.281f,
        79.8816f,
        79.4823f,
        79.0829f,
        78.6836f,
        78.2842f,
        77.4279f,
        76.5716f,
        75.7153f,
        74.859f,
        74.0027f,
        73.1465f,
        72.2902f,
        71.4339f,
        70.5776f,
        69.7213f,
        69.9101f,
        70.0989f,
        70.2876f,
        70.4764f,
        70.6652f,
        70.854f,
        71.0428f,
        71.2315f,
        71.4203f,
        71.6091f,
        71.8831f,
        72.1571f,
        72.4311f,
        72.7051f,
        72.979f,
        73.253f,
        73.527f,
        73.801f,
        74.075f,
        74.349f,
        73.0745f,
        71.8f,
        70.5255f,
        69.251f,
        67.9765f,
        66.702f,
        65.4275f,
        64.153f,
        62.8785f,
        61.604f,
        62.4322f,
        63.2603f,
        64.0885f,
        64.9166f,
        65.7448f,
        66.573f,
        67.4011f,
        68.2293f,
        69.0574f,
        69.8856f,
        70.4057f,
        70.9259f,
        71.446f,
        71.9662f,
        72.4863f,
        73.0064f,
        73.5266f,
        74.0467f,
        74.5669f,
        75.087f,
        73.9376f,
        72.7881f,
        71.6387f,
        70.4893f,
        69.3398f,
        68.1904f,
        67.041f,
        65.8916f,
        64.7421f,
        63.5927f,
        61.8752f,
        60.1578f,
        58.4403f,
        56.7229f,
        55.0054f,
        53.288f,
        51.5705f,
        49.8531f,
        48.1356f,
        46.4182f,
        48.4569f,
        50.4956f,
        52.5344f,
        54.5731f,
        56.6118f,
        58.6505f,
        60.6892f,
        62.728f,
        64.7667f,
        66.8054f,
        66.4631f,
        66.1209f,
        65.7786f,
        65.4364f,
        65.0941f,
        64.7518f,
        64.4096f,
        64.0673f,
        63.7251f,
        63.3828f,
        63.4749f,
        63.567f,
        63.6592f,
        63.7513f,
        63.8434f,
        63.9355f,
        64.0276f,
        64.1198f,
        64.2119f,
        64.304f
};

int main(int argc, char* argv[]) {
    static_assert(CIE_LMSR_COUNT == CIE_D65_COUNT && CIE_LMSR_COUNT == REC_709_REFLECTANCE_COUNT);

    handleArguments(argc, argv);

    // TODO: Should we normalize the D65 spectrum?
#if 0
    float maxD65 = 0.0f;
    for (size_t i = 0; i < CIE_D65_COUNT; i++) {
        maxD65 = std::max(maxD65, CIE_D65[i]);
    }
#else
    float maxD65 = 1.0f;
#endif

    float3 l{0.0f};
    float3 m{0.0f};
    float3 s{0.0f};
    float3 r{0.0f};

    for (size_t j = 0; j < 3; j++) {
        for (size_t w = 0; w < CIE_LMSR_COUNT; w++) {
            l[j] += CIE_LMSR[w].x * CIE_D65[w] / maxD65 * REC_709_REFLECTANCE[w][j];
            m[j] += CIE_LMSR[w].y * CIE_D65[w] / maxD65 * REC_709_REFLECTANCE[w][j];
            s[j] += CIE_LMSR[w].z * CIE_D65[w] / maxD65 * REC_709_REFLECTANCE[w][j];
            r[j] += CIE_LMSR[w].w * CIE_D65[w] / maxD65 * REC_709_REFLECTANCE[w][j];
        }
        l[j] /= CIE_LMSR_COUNT;
        m[j] /= CIE_LMSR_COUNT;
        s[j] /= CIE_LMSR_COUNT;
        r[j] /= CIE_LMSR_COUNT;
    }

    std::cout << "Rec.709 to LMSR matrix (4x3, column major):" << std::endl;
    std::cout << std::fixed << std::setprecision(6) << l.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << l.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << l.b << ", ";;
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << m.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << m.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << m.b << ", ";;
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << s.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << s.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << s.b << ", ";;
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << r.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << r.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << r.b;
    std::cout << std::endl;

    return 0;
}
