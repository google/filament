/*
 * Copyright (C) 2021 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#include <cstdlib>
#include <iomanip>
#include <iostream>

#include <getopt/getopt.h>

#include <utils/Path.h>

#include <math/mat3.h>
#include <math/scalar.h>
#include <math/vec3.h>

using namespace filament::math;

static bool g_normalize = false;

static void printUsage(const char* name) {
    std::string execName(utils::Path(name).getName());
    std::string usage(
            "RGB_TO_LMSR computes an RGB (Rec.709) to LMSR transform matrix\n"
                    "Usage:\n"
                    "    RGB_TO_LMSR\n"
                    "\n"
                    "Options:\n"
                    "   --help, -h\n"
                    "       Print this message\n\n"
                    "   --license\n"
                    "       Print copyright and license information\n\n"
                    "   --normalize, -n\n"
                    "       Normalize the generated matrix\n\n"
    );

    const std::string from("RGB_TO_LMSR");
    for (size_t pos = usage.find(from); pos != std::string::npos; pos = usage.find(from, pos)) {
        usage.replace(pos, from.length(), execName);
    }
    printf("%s", usage.c_str());
}

static void license() {
    static const char *license[] = {
        #include "licenses/licenses.inc"
        nullptr
    };

    const char **p = &license[0];
    while (*p)
        std::cout << *p++ << std::endl;
}

static int handleArguments(int argc, char* argv[]) {
    static constexpr const char* OPTSTR = "hln";
    static const struct option OPTIONS[] = {
        { "help",         no_argument, nullptr, 'h' },
        { "license",      no_argument, nullptr, 'l' },
        { "normalize",    no_argument, nullptr, 'n' },
        { nullptr, 0, nullptr, 0 }  // termination of the option list
    };

    int opt;
    int optionIndex = 0;

    while ((opt = getopt_long(argc, argv, OPTSTR, OPTIONS, &optionIndex)) >= 0) {
        std::string arg(optarg ? optarg : "");
        switch (opt) {
            default:
            case 'h':
                printUsage(argv[0]);
                exit(0);
            case 'l':
                license();
                exit(0);
            case 'n':
                g_normalize = true;
                break;
        }
    }

    return optind;
}

// CIE 1931 reflectance spectrum for Rec.709 from 390nm to 790nm
//
// Data source:
//     http://scottburns.us/fast-rgb-to-spectrum-conversion-for-reflectances/
const size_t REC_709_REFLECTANCE_COUNT = 401;
const double3 REC_709_REFLECTANCE[REC_709_REFLECTANCE_COUNT] = { // NOLINT
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028818291, 0.011877002, 0.959304707},
        {0.028811021, 0.011877002, 0.959311977},
        {0.028802781, 0.011877002, 0.959320217},
        {0.028793521, 0.011877002, 0.959329477},
        {0.028782960, 0.011877002, 0.959340038},
        {0.028770917, 0.011877002, 0.959352080},
        {0.028757342, 0.011877002, 0.959365656},
        {0.028741827, 0.011877002, 0.959381171},
        {0.028724190, 0.011877002, 0.959398808},
        {0.028704048, 0.011877002, 0.959418950},
        {0.028681031, 0.011886657, 0.959432313},
        {0.028654760, 0.011897721, 0.959447519},
        {0.028624766, 0.011910316, 0.959464919},
        {0.028590487, 0.011924700, 0.959484814},
        {0.028551637, 0.011941085, 0.959507279},
        {0.028507641, 0.011959757, 0.959532602},
        {0.028457679, 0.011980956, 0.959561366},
        {0.028401308, 0.012005032, 0.959593661},
        {0.028337507, 0.012032367, 0.959630128},
        {0.028265518, 0.012063369, 0.959671114},
        {0.028184712, 0.012098436, 0.959716853},
        {0.028093938, 0.012138183, 0.959767881},
        {0.027992225, 0.012183090, 0.959824687},
        {0.027878758, 0.012233713, 0.959887532},
        {0.027752728, 0.012290715, 0.959956560},
        {0.027613202, 0.012354682, 0.960032118},
        {0.027459639, 0.012426334, 0.960114030},
        {0.027291406, 0.012506237, 0.960202360},
        {0.027108029, 0.012595103, 0.960296871},
        {0.026909351, 0.012693590, 0.960397062},
        {0.026695068, 0.012802303, 0.960502632},
        {0.026465327, 0.012922024, 0.960612653},
        {0.026219780, 0.013053697, 0.960726528},
        {0.025958190, 0.013198476, 0.960843339},
        {0.025680593, 0.013357408, 0.960962004},
        {0.025387006, 0.013531737, 0.961081261},
        {0.025077520, 0.013722843, 0.961199642},
        {0.024752635, 0.013932033, 0.961315337},
        {0.024412905, 0.014160874, 0.961426226},
        {0.024058830, 0.014411037, 0.961530138},
        {0.023691176, 0.014684282, 0.961624548},
        {0.023310840, 0.014982637, 0.961706529},
        {0.022918745, 0.015308115, 0.961773146},
        {0.022516080, 0.015663026, 0.961820900},
        {0.022103926, 0.016049824, 0.961846257},
        {0.021683511, 0.016471404, 0.961845091},
        {0.021256027, 0.016930724, 0.961813257},
        {0.020822729, 0.017431474, 0.961745804},
        {0.020384772, 0.017977408, 0.961637827},
        {0.019943276, 0.018573130, 0.961483602},
        {0.019499471, 0.019223505, 0.961277031},
        {0.019054471, 0.019934375, 0.961011161},
        {0.018609424, 0.020711793, 0.960678791},
        {0.018165471, 0.021562842, 0.960271695},
        {0.017723519, 0.022495442, 0.959781047},
        {0.017284601, 0.023518720, 0.959196687},
        {0.016849621, 0.024643089, 0.958507298},
        {0.016419409, 0.025880449, 0.957700149},
        {0.015994666, 0.027244468, 0.956760874},
        {0.015576139, 0.028750929, 0.955672940},
        {0.015164369, 0.030417962, 0.954417677},
        {0.014759893, 0.032266650, 0.952973465},
        {0.014363270, 0.034321187, 0.951315551},
        {0.013974834, 0.036609597, 0.949415576},
        {0.013594951, 0.039164589, 0.947240469},
        {0.013223980, 0.042024179, 0.944751849},
        {0.012862081, 0.045232687, 0.941905240},
        {0.012509509, 0.048841513, 0.938648986},
        {0.012166415, 0.052910539, 0.934923054},
        {0.011832836, 0.057509680, 0.930657491},
        {0.011508938, 0.062721079, 0.925769991},
        {0.011194664, 0.068641244, 0.920164100},
        {0.010890006, 0.075385301, 0.913724701},
        {0.010594921, 0.083088729, 0.906316358},
        {0.010309243, 0.091912392, 0.897778373},
        {0.010032852, 0.102044876, 0.887922279},
        {0.009765620, 0.113708114, 0.876526273},
        {0.009507356, 0.127159828, 0.863332823},
        {0.009257866, 0.142696430, 0.848045711},
        {0.009016900, 0.160651591, 0.830331517},
        {0.008784129, 0.181390517, 0.809825361},
        {0.008559389, 0.205290227, 0.786150391},
        {0.008342333, 0.232698734, 0.758958940},
        {0.008132602, 0.263880897, 0.727986508},
        {0.007929888, 0.298929894, 0.693140225},
        {0.007733877, 0.337660526, 0.654605604},
        {0.007544324, 0.379519416, 0.612936267},
        {0.007361023, 0.423563429, 0.569075555},
        {0.007183855, 0.468553426, 0.524262725},
        {0.007012745, 0.513160591, 0.479826671},
        {0.006847712, 0.556197975, 0.436954319},
        {0.006688746, 0.596774501, 0.396536760},
        {0.006535881, 0.634336924, 0.359127201},
        {0.006389133, 0.668637252, 0.324973622},
        {0.006248471, 0.699655061, 0.294096474},
        {0.006113831, 0.727519207, 0.266366969},
        {0.005985160, 0.752443966, 0.241570880},
        {0.005862418, 0.774683948, 0.219453641},
        {0.005745439, 0.794504131, 0.199750437},
        {0.005634161, 0.812162229, 0.182203618},
        {0.005528477, 0.827899667, 0.166571863},
        {0.005428285, 0.841936088, 0.152635634},
        {0.005333500, 0.854469313, 0.140197194},
        {0.005244008, 0.865675487, 0.129080512},
        {0.005159746, 0.875710212, 0.119130050},
        {0.005080630, 0.884710460, 0.110208918},
        {0.005006586, 0.892796076, 0.102197347},
        {0.004937545, 0.900072521, 0.094989942},
        {0.004873420, 0.906632179, 0.088494410},
        {0.004814165, 0.912555819, 0.082630025},
        {0.004759755, 0.917913767, 0.077326487},
        {0.004710142, 0.922768547, 0.072521320},
        {0.004665292, 0.927174110, 0.068160607},
        {0.004625163, 0.931178591, 0.064196255},
        {0.004589756, 0.934823889, 0.060586364},
        {0.004559076, 0.938146992, 0.057293941},
        {0.004533115, 0.941180584, 0.054286310},
        {0.004511878, 0.943953492, 0.051534640},
        {0.004495412, 0.946491400, 0.049013197},
        {0.004483749, 0.948816965, 0.046699295},
        {0.004476933, 0.950950467, 0.044572609},
        {0.004475011, 0.952909752, 0.042615247},
        {0.004478088, 0.954710433, 0.040811489},
        {0.004486263, 0.956366386, 0.039147361},
        {0.004499670, 0.957890048, 0.037610292},
        {0.004518465, 0.959292655, 0.036188889},
        {0.004542805, 0.960584215, 0.034872990},
        {0.004572880, 0.961773573, 0.033653556},
        {0.004608895, 0.962868623, 0.032522492},
        {0.004651090, 0.963876448, 0.031472471},
        {0.004699746, 0.964803350, 0.030496912},
        {0.004755186, 0.965655044, 0.029589778},
        {0.004817721, 0.966436842, 0.028745446},
        {0.004887673, 0.967153428, 0.027958907},
        {0.004965447, 0.967808972, 0.027225590},
        {0.005051466, 0.968407165, 0.026541377},
        {0.005146221, 0.968951191, 0.025902595},
        {0.005250261, 0.969443961, 0.025305785},
        {0.005364196, 0.969887939, 0.024747872},
        {0.005488688, 0.970285274, 0.024226044},
        {0.005624523, 0.970637837, 0.023737647},
        {0.005772524, 0.970947128, 0.023280354},
        {0.005933641, 0.971214249, 0.022852116},
        {0.006108994, 0.971440082, 0.022450930},
        {0.006299756, 0.971625195, 0.022075054},
        {0.006507247, 0.971769994, 0.021722764},
        {0.006733051, 0.971874423, 0.021392531},
        {0.006978854, 0.971938200, 0.021082950},
        {0.007246538, 0.971960799, 0.020792667},
        {0.007538270, 0.971941249, 0.020520485},
        {0.007856514, 0.971878264, 0.020265225},
        {0.008204064, 0.971770126, 0.020025813},
        {0.008583947, 0.971614816, 0.019801239},
        {0.008999675, 0.971409878, 0.019590449},
        {0.009455237, 0.971152241, 0.019392523},
        {0.009955215, 0.970838189, 0.019206597},
        {0.010504749, 0.970463452, 0.019031800},
        {0.011109803, 0.970022766, 0.018867431},
        {0.011777308, 0.969510027, 0.018712665},
        {0.012515126, 0.968918048, 0.018566825},
        {0.013332373, 0.968238420, 0.018429206},
        {0.014239681, 0.967461152, 0.018299166},
        {0.015249411, 0.966574582, 0.018176005},
        {0.016375927, 0.965564859, 0.018059211},
        {0.017636162, 0.964415670, 0.017948165},
        {0.019050053, 0.963107683, 0.017842261},
        {0.020640980, 0.961618056, 0.017740960},
        {0.022436706, 0.959919497, 0.017643792},
        {0.024470247, 0.957979541, 0.017550207},
        {0.026781156, 0.955759173, 0.017459665},
        {0.029416764, 0.953211636, 0.017371594},
        {0.032434165, 0.950280250, 0.017285579},
        {0.035902660, 0.946896161, 0.017201171},
        {0.039906710, 0.942975375, 0.017117908},
        {0.044549637, 0.938415042, 0.017035312},
        {0.049957946, 0.933089100, 0.016952945},
        {0.056288019, 0.926841641, 0.016870331},
        {0.063732852, 0.919480119, 0.016787020},
        {0.072532236, 0.910765162, 0.016702592},
        {0.082984390, 0.900398982, 0.016616618},
        {0.095460490, 0.888010848, 0.016528651},
        {0.110421040, 0.873140755, 0.016438193},
        {0.128430384, 0.855224817, 0.016344788},
        {0.150174712, 0.833577319, 0.016247957},
        {0.176468480, 0.807384293, 0.016147214},
        {0.208235667, 0.775722345, 0.016041975},
        {0.246440024, 0.737628435, 0.015931528},
        {0.291908018, 0.692276903, 0.015815065},
        {0.344984668, 0.639323614, 0.015691704},
        {0.405003302, 0.579436097, 0.015560587},
        {0.469770292, 0.514808650, 0.015421044},
        {0.535622243, 0.449104730, 0.015273012},
        {0.598446474, 0.386436255, 0.015117256},
        {0.655118405, 0.329926299, 0.014955281},
        {0.704188549, 0.281022574, 0.014788861},
        {0.745606932, 0.239773366, 0.014619686},
        {0.780098645, 0.205452132, 0.014449208},
        {0.808669226, 0.177052183, 0.014278574},
        {0.832329195, 0.153562082, 0.014108706},
        {0.851973460, 0.134086206, 0.013940317},
        {0.868355627, 0.117870335, 0.013774022},
        {0.882088371, 0.104301317, 0.013610295},
        {0.893665842, 0.092884622, 0.013449518},
        {0.903484049, 0.083223919, 0.013292015},
        {0.911858005, 0.075003924, 0.013138054},
        {0.919041310, 0.067970837, 0.012987836},
        {0.925236892, 0.061921566, 0.012841525},
        {0.930609071, 0.056691665, 0.012699247},
        {0.935290842, 0.052148021, 0.012561120},
        {0.939390513, 0.048182279, 0.012427191},
        {0.942996767, 0.044705727, 0.012297489},
        {0.946182355, 0.041645556, 0.012172072},
        {0.949008025, 0.038941093, 0.012050866},
        {0.951523919, 0.036542201, 0.011933864},
        {0.953772082, 0.034406857, 0.011821045},
        {0.955787697, 0.032499914, 0.011712372},
        {0.957600446, 0.030791764, 0.011607774},
        {0.959235683, 0.029257157, 0.011507144},
        {0.960714776, 0.027874770, 0.011410438},
        {0.962055945, 0.026626454, 0.011317586},
        {0.963275107, 0.025496410, 0.011228468},
        {0.964300437, 0.024471080, 0.011228468},
        {0.965232800, 0.023538717, 0.011228468},
        {0.966082492, 0.022689026, 0.011228468},
        {0.966858432, 0.021913087, 0.011228468},
        {0.967568415, 0.021203103, 0.011228468},
        {0.968219303, 0.020552216, 0.011228468},
        {0.968817046, 0.019954474, 0.011228468},
        {0.969366905, 0.019404615, 0.011228468},
        {0.969873478, 0.018898043, 0.011228468},
        {0.970340909, 0.018430612, 0.011228468},
        {0.970772869, 0.017998652, 0.011228468},
        {0.971172383, 0.017599138, 0.011228468},
        {0.971542180, 0.017229342, 0.011228468},
        {0.971884776, 0.016886746, 0.011228468},
        {0.972202337, 0.016569185, 0.011228468},
        {0.972496890, 0.016274633, 0.011228468},
        {0.972770257, 0.016001266, 0.011228468},
        {0.973023999, 0.015747524, 0.011228468},
        {0.973259632, 0.015511892, 0.011228468},
        {0.973478536, 0.015292988, 0.011228468},
        {0.973681941, 0.015089583, 0.011228468},
        {0.973870951, 0.014900573, 0.011228468},
        {0.974046776, 0.014724748, 0.011228468},
        {0.974210313, 0.014561212, 0.011228468},
        {0.974362517, 0.014409008, 0.011228468},
        {0.974504245, 0.014267281, 0.011228468},
        {0.974636162, 0.014135364, 0.011228468},
        {0.974759150, 0.014012377, 0.011228468},
        {0.974873710, 0.013897817, 0.011228468},
        {0.974980528, 0.013790999, 0.011228468},
        {0.975080171, 0.013691356, 0.011228468},
        {0.975173072, 0.013598455, 0.011228468},
        {0.975259696, 0.013511832, 0.011228468},
        {0.975340480, 0.013431048, 0.011228468},
        {0.975415806, 0.013355721, 0.011228468},
        {0.975486006, 0.013285522, 0.011228468},
        {0.975551437, 0.013220092, 0.011228468},
        {0.975612438, 0.013159090, 0.011228468},
        {0.975669295, 0.013102234, 0.011228468},
        {0.975722246, 0.013049283, 0.011228468},
        {0.975771580, 0.012999949, 0.011228468},
        {0.975817540, 0.012953989, 0.011228468},
        {0.975860350, 0.012911179, 0.011228468},
        {0.975900220, 0.012871310, 0.011228468},
        {0.975937277, 0.012834253, 0.011228468},
        {0.975971818, 0.012799711, 0.011228468},
        {0.976003931, 0.012767598, 0.011228468},
        {0.976033845, 0.012737685, 0.011228468},
        {0.976061665, 0.012709865, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468},
        {0.976087481, 0.012684050, 0.011228468}
};

// Cone (LMS) data from: Stockman & Sharpe (2000) / 2-deg fundamentals based on the
// Stiles & Burch 10-deg CMFs (adjusted to 2-deg). Data source: http://www.cvrl.org/cones.htm
// Rod (R)  data from: CIE (1951) Scotopic V'(λ). Data source: http://www.cvrl.org/lumindex.htm
const size_t CIE_LMSR_COUNT = 401;
const float4 CIE_LMSR[CIE_LMSR_COUNT] = { // NOLINT
        {4.15003E-04, 3.68349E-04, 9.54729E-03, 0.0022090000},
        {5.02650E-04, 4.48015E-04, 1.14794E-02, 0.0025470000},
        {6.07367E-04, 5.43965E-04, 1.37986E-02, 0.0029390000},
        {7.31850E-04, 6.58983E-04, 1.65746E-02, 0.0033940000},
        {8.79012E-04, 7.96121E-04, 1.98869E-02, 0.0039210000},
        {1.05192E-03, 9.58658E-04, 2.38250E-02, 0.0045300000},
        {1.25373E-03, 1.15002E-03, 2.84877E-02, 0.0052400000},
        {1.48756E-03, 1.37367E-03, 3.39832E-02, 0.0060500000},
        {1.75633E-03, 1.63296E-03, 4.04274E-02, 0.0069800000},
        {2.06261E-03, 1.93089E-03, 4.79417E-02, 0.0080600000},
        {2.40836E-03, 2.26991E-03, 5.66498E-02, 0.0092900000},
        {2.79522E-03, 2.65210E-03, 6.66757E-02, 0.0107000000},
        {3.22640E-03, 3.08110E-03, 7.81479E-02, 0.0123100000},
        {3.70617E-03, 3.56156E-03, 9.11925E-02, 0.0141300000},
        {4.23972E-03, 4.09900E-03, 1.05926E-01, 0.0161900000},
        {4.83339E-03, 4.70010E-03, 1.22451E-01, 0.0185200000},
        {5.49335E-03, 5.37186E-03, 1.40844E-01, 0.0211300000},
        {6.21933E-03, 6.11757E-03, 1.61140E-01, 0.0240500000},
        {7.00631E-03, 6.93795E-03, 1.83325E-01, 0.0273000000},
        {7.84503E-03, 7.83144E-03, 2.07327E-01, 0.0308900000},
        {8.72127E-03, 8.79369E-03, 2.33008E-01, 0.0348400000},
        {9.61879E-03, 9.81865E-03, 2.60183E-01, 0.0391600000},
        {1.05324E-02, 1.09044E-02, 2.88723E-01, 0.0439000000},
        {1.14620E-02, 1.20509E-02, 3.18512E-01, 0.0490000000},
        {1.24105E-02, 1.32582E-02, 3.49431E-01, 0.0545000000},
        {1.33837E-02, 1.45277E-02, 3.81363E-01, 0.0604000000},
        {1.43870E-02, 1.58600E-02, 4.14141E-01, 0.0668000000},
        {1.54116E-02, 1.72496E-02, 4.47350E-01, 0.0736000000},
        {1.64424E-02, 1.86878E-02, 4.80439E-01, 0.0808000000},
        {1.74614E-02, 2.01638E-02, 5.12767E-01, 0.0885000000},
        {1.84480E-02, 2.16649E-02, 5.43618E-01, 0.0966000000},
        {1.93852E-02, 2.31801E-02, 5.72399E-01, 0.1052000000},
        {2.02811E-02, 2.47139E-02, 5.99284E-01, 0.1141000000},
        {2.11545E-02, 2.62785E-02, 6.24786E-01, 0.1235000000},
        {2.20286E-02, 2.78905E-02, 6.49576E-01, 0.1334000000},
        {2.29317E-02, 2.95714E-02, 6.74474E-01, 0.1436000000},
        {2.38896E-02, 3.13438E-02, 7.00186E-01, 0.1541000000},
        {2.49026E-02, 3.32151E-02, 7.26460E-01, 0.1651000000},
        {2.59631E-02, 3.51889E-02, 7.52726E-01, 0.1764000000},
        {2.70619E-02, 3.72683E-02, 7.78333E-01, 0.1879000000},
        {2.81877E-02, 3.94566E-02, 8.02555E-01, 0.1998000000},
        {2.93303E-02, 4.17546E-02, 8.24818E-01, 0.2119000000},
        {3.04898E-02, 4.41544E-02, 8.45422E-01, 0.2243000000},
        {3.16694E-02, 4.66432E-02, 8.64961E-01, 0.2369000000},
        {3.28731E-02, 4.92050E-02, 8.84100E-01, 0.2496000000},
        {3.41054E-02, 5.18199E-02, 9.03573E-01, 0.2625000000},
        {3.53670E-02, 5.44645E-02, 9.23844E-01, 0.2755000000},
        {3.66400E-02, 5.71131E-02, 9.44055E-01, 0.2886000000},
        {3.78988E-02, 5.97369E-02, 9.62920E-01, 0.3017000000},
        {3.91148E-02, 6.23038E-02, 9.79057E-01, 0.3149000000},
        {4.02563E-02, 6.47782E-02, 9.91020E-01, 0.3281000000},
        {4.12989E-02, 6.71329E-02, 9.97765E-01, 0.3412000000},
        {4.22582E-02, 6.93844E-02, 9.99982E-01, 0.3543000000},
        {4.31627E-02, 7.15658E-02, 9.98861E-01, 0.3673000000},
        {4.40444E-02, 7.37164E-02, 9.95628E-01, 0.3803000000},
        {4.49380E-02, 7.58812E-02, 9.91515E-01, 0.3931000000},
        {4.58729E-02, 7.80980E-02, 9.87377E-01, 0.4060000000},
        {4.68459E-02, 8.03538E-02, 9.82619E-01, 0.4180000000},
        {4.78446E-02, 8.26198E-02, 9.76301E-01, 0.4310000000},
        {4.88555E-02, 8.48644E-02, 9.67513E-01, 0.4430000000},
        {4.98639E-02, 8.70524E-02, 9.55393E-01, 0.4550000000},
        {5.08618E-02, 8.91640E-02, 9.39499E-01, 0.4670000000},
        {5.18731E-02, 9.12523E-02, 9.20807E-01, 0.4790000000},
        {5.29317E-02, 9.33950E-02, 9.00592E-01, 0.4900000000},
        {5.40746E-02, 9.56775E-02, 8.80040E-01, 0.5020000000},
        {5.53418E-02, 9.81934E-02, 8.60240E-01, 0.5130000000},
        {5.67734E-02, 1.01031E-01, 8.42031E-01, 0.5240000000},
        {5.83973E-02, 1.04229E-01, 8.25572E-01, 0.5350000000},
        {6.02409E-02, 1.07814E-01, 8.10860E-01, 0.5460000000},
        {6.23353E-02, 1.11817E-01, 7.97902E-01, 0.5570000000},
        {6.47164E-02, 1.16272E-01, 7.86704E-01, 0.5670000000},
        {6.74131E-02, 1.21204E-01, 7.77119E-01, 0.5780000000},
        {7.04040E-02, 1.26573E-01, 7.68365E-01, 0.5880000000},
        {7.36489E-02, 1.32311E-01, 7.59538E-01, 0.5990000000},
        {7.70978E-02, 1.38334E-01, 7.49777E-01, 0.6100000000},
        {8.06894E-02, 1.44541E-01, 7.38268E-01, 0.6200000000},
        {8.43613E-02, 1.50828E-01, 7.24389E-01, 0.6310000000},
        {8.80904E-02, 1.57146E-01, 7.08113E-01, 0.6420000000},
        {9.18630E-02, 1.63457E-01, 6.89572E-01, 0.6530000000},
        {9.56637E-02, 1.69721E-01, 6.68927E-01, 0.6640000000},
        {9.94755E-02, 1.75893E-01, 6.46359E-01, 0.6760000000},
        {1.03286E-01, 1.81938E-01, 6.22112E-01, 0.6870000000},
        {1.07103E-01, 1.87872E-01, 5.96591E-01, 0.6990000000},
        {1.10947E-01, 1.93731E-01, 5.70216E-01, 0.7100000000},
        {1.14838E-01, 1.99557E-01, 5.43373E-01, 0.7220000000},
        {1.18802E-01, 2.05398E-01, 5.16411E-01, 0.7340000000},
        {1.22863E-01, 2.11302E-01, 4.89647E-01, 0.7450000000},
        {1.27026E-01, 2.17283E-01, 4.63406E-01, 0.7570000000},
        {1.31293E-01, 2.23347E-01, 4.37965E-01, 0.7690000000},
        {1.35666E-01, 2.29501E-01, 4.13549E-01, 0.7810000000},
        {1.40145E-01, 2.35754E-01, 3.90333E-01, 0.7930000000},
        {1.44731E-01, 2.42108E-01, 3.68394E-01, 0.8050000000},
        {1.49415E-01, 2.48545E-01, 3.47582E-01, 0.8170000000},
        {1.54189E-01, 2.55037E-01, 3.27724E-01, 0.8280000000},
        {1.59038E-01, 2.61554E-01, 3.08676E-01, 0.8400000000},
        {1.63952E-01, 2.68063E-01, 2.90322E-01, 0.8510000000},
        {1.68932E-01, 2.74561E-01, 2.72626E-01, 0.8620000000},
        {1.74063E-01, 2.81180E-01, 2.55772E-01, 0.8730000000},
        {1.79457E-01, 2.88097E-01, 2.39945E-01, 0.8840000000},
        {1.85241E-01, 2.95508E-01, 2.25280E-01, 0.8940000000},
        {1.91556E-01, 3.03630E-01, 2.11867E-01, 0.9040000000},
        {1.98532E-01, 3.12649E-01, 1.99719E-01, 0.9140000000},
        {2.06182E-01, 3.22565E-01, 1.88674E-01, 0.9230000000},
        {2.14485E-01, 3.33319E-01, 1.78557E-01, 0.9320000000},
        {2.23411E-01, 3.44844E-01, 1.69217E-01, 0.9410000000},
        {2.32926E-01, 3.57061E-01, 1.60526E-01, 0.9490000000},
        {2.42992E-01, 3.69895E-01, 1.52368E-01, 0.9570000000},
        {2.53616E-01, 3.83355E-01, 1.44620E-01, 0.9640000000},
        {2.64810E-01, 3.97467E-01, 1.37173E-01, 0.9700000000},
        {2.76587E-01, 4.12260E-01, 1.29937E-01, 0.9760000000},
        {2.88959E-01, 4.27764E-01, 1.22839E-01, 0.9820000000},
        {3.01934E-01, 4.44001E-01, 1.15834E-01, 0.9860000000},
        {3.15508E-01, 4.60947E-01, 1.08922E-01, 0.9900000000},
        {3.29673E-01, 4.78562E-01, 1.02118E-01, 0.9940000000},
        {3.44416E-01, 4.96795E-01, 9.54374E-02, 0.9970000000},
        {3.59716E-01, 5.15587E-01, 8.88965E-02, 0.9980000000},
        {3.75550E-01, 5.34868E-01, 8.25343E-02, 1.0000000000},
        {3.91895E-01, 5.54575E-01, 7.64613E-02, 1.0000000000},
        {4.08722E-01, 5.74640E-01, 7.07769E-02, 1.0000000000},
        {4.25998E-01, 5.94984E-01, 6.55491E-02, 0.9980000000},
        {4.43683E-01, 6.15520E-01, 6.08210E-02, 0.9970000000},
        {4.61731E-01, 6.36162E-01, 5.65919E-02, 0.9940000000},
        {4.80094E-01, 6.56872E-01, 5.27659E-02, 0.9900000000},
        {4.98717E-01, 6.77624E-01, 4.92440E-02, 0.9860000000},
        {5.17539E-01, 6.98393E-01, 4.59470E-02, 0.9810000000},
        {5.36494E-01, 7.19154E-01, 4.28123E-02, 0.9750000000},
        {5.55493E-01, 7.39844E-01, 3.98014E-02, 0.9680000000},
        {5.74386E-01, 7.60235E-01, 3.69227E-02, 0.9610000000},
        {5.92995E-01, 7.80039E-01, 3.41909E-02, 0.9530000000},
        {6.11124E-01, 7.98941E-01, 3.16158E-02, 0.9440000000},
        {6.28561E-01, 8.16610E-01, 2.92033E-02, 0.9350000000},
        {6.45139E-01, 8.32783E-01, 2.69536E-02, 0.9250000000},
        {6.60907E-01, 8.47550E-01, 2.48575E-02, 0.9150000000},
        {6.75993E-01, 8.61113E-01, 2.29047E-02, 0.9040000000},
        {6.90542E-01, 8.73698E-01, 2.10855E-02, 0.8920000000},
        {7.04720E-01, 8.85550E-01, 1.93912E-02, 0.8800000000},
        {7.18662E-01, 8.96873E-01, 1.78145E-02, 0.8670000000},
        {7.32323E-01, 9.07638E-01, 1.63514E-02, 0.8540000000},
        {7.45606E-01, 9.17757E-01, 1.49980E-02, 0.8400000000},
        {7.58410E-01, 9.27137E-01, 1.37497E-02, 0.8260000000},
        {7.70630E-01, 9.35687E-01, 1.26013E-02, 0.8110000000},
        {7.82208E-01, 9.43362E-01, 1.15466E-02, 0.7960000000},
        {7.93290E-01, 9.50309E-01, 1.05766E-02, 0.7810000000},
        {8.04084E-01, 9.56733E-01, 9.68268E-03, 0.7650000000},
        {8.14813E-01, 9.62844E-01, 8.85746E-03, 0.7490000000},
        {8.25711E-01, 9.68858E-01, 8.09453E-03, 0.7330000000},
        {8.36943E-01, 9.74919E-01, 7.38890E-03, 0.7170000000},
        {8.48349E-01, 9.80850E-01, 6.73799E-03, 0.7000000000},
        {8.59676E-01, 9.86388E-01, 6.13947E-03, 0.6830000000},
        {8.70656E-01, 9.91267E-01, 5.59073E-03, 0.6670000000},
        {8.81011E-01, 9.95217E-01, 5.08900E-03, 0.6500000000},
        {8.90496E-01, 9.98007E-01, 4.63120E-03, 0.6330000000},
        {8.99052E-01, 9.99595E-01, 4.21366E-03, 0.6160000000},
        {9.06669E-01, 9.99982E-01, 3.83286E-03, 0.5990000000},
        {9.13341E-01, 9.99177E-01, 3.48559E-03, 0.5810000000},
        {9.19067E-01, 9.97193E-01, 3.16893E-03, 0.5640000000},
        {9.23898E-01, 9.94102E-01, 2.88021E-03, 0.5480000000},
        {9.28099E-01, 9.90204E-01, 2.61698E-03, 0.5310000000},
        {9.31995E-01, 9.85855E-01, 2.37701E-03, 0.5140000000},
        {9.35916E-01, 9.81404E-01, 2.15829E-03, 0.4970000000},
        {9.40198E-01, 9.77193E-01, 1.95896E-03, 0.4810000000},
        {9.45076E-01, 9.73441E-01, 1.77737E-03, 0.4650000000},
        {9.50367E-01, 9.69881E-01, 1.61218E-03, 0.4480000000},
        {9.55775E-01, 9.66133E-01, 1.46215E-03, 0.4330000000},
        {9.61000E-01, 9.61823E-01, 1.32606E-03, 0.4170000000},
        {9.65733E-01, 9.56583E-01, 1.20277E-03, 0.4020000000},
        {9.69744E-01, 9.50167E-01, 1.09118E-03, 0.3864000000},
        {9.73133E-01, 9.42773E-01, 9.90135E-04, 0.3715000000},
        {9.76086E-01, 9.34709E-01, 8.98564E-04, 0.3569000000},
        {9.78793E-01, 9.26271E-01, 8.15524E-04, 0.3427000000},
        {9.81445E-01, 9.17750E-01, 7.40174E-04, 0.3288000000},
        {9.84186E-01, 9.09339E-01, 6.71772E-04, 0.3151000000},
        {9.86965E-01, 9.00895E-01, 6.09693E-04, 0.3018000000},
        {9.89678E-01, 8.92197E-01, 5.53372E-04, 0.2888000000},
        {9.92220E-01, 8.83035E-01, 5.02292E-04, 0.2762000000},
        {9.94486E-01, 8.73205E-01, 4.55979E-04, 0.2639000000},
        {9.96386E-01, 8.62565E-01, 4.13997E-04, 0.2519000000},
        {9.97895E-01, 8.51173E-01, 3.75940E-04, 0.2403000000},
        {9.99004E-01, 8.39132E-01, 3.41439E-04, 0.2291000000},
        {9.99706E-01, 8.26545E-01, 3.10160E-04, 0.2182000000},
        {9.99993E-01, 8.13509E-01, 2.81800E-04, 0.2076000000},
        {9.99837E-01, 8.00082E-01, 2.56084E-04, 0.1974000000},
        {9.99123E-01, 7.86166E-01, 2.32764E-04, 0.1876000000},
        {9.97719E-01, 7.71635E-01, 2.11616E-04, 0.1782000000},
        {9.95491E-01, 7.56376E-01, 1.92436E-04, 0.1690000000},
        {9.92310E-01, 7.40291E-01, 1.75039E-04, 0.1602000000},
        {9.88146E-01, 7.23369E-01, 1.59257E-04, 0.1517000000},
        {9.83345E-01, 7.05890E-01, 1.44940E-04, 0.1436000000},
        {9.78342E-01, 6.88184E-01, 1.31948E-04, 0.1358000000},
        {9.73564E-01, 6.70554E-01, 1.20157E-04, 0.1284000000},
        {9.69429E-01, 6.53274E-01, 1.09454E-04, 0.1212000000},
        {9.66211E-01, 6.36524E-01, 9.97367E-05, 0.1143000000},
        {9.63630E-01, 6.20217E-01, 9.09125E-05, 0.1078000000},
        {9.61273E-01, 6.04211E-01, 8.28976E-05, 0.1015000000},
        {9.58732E-01, 5.88375E-01, 7.56160E-05, 0.0956000000},
        {9.55602E-01, 5.72597E-01, 6.89991E-05, 0.0899000000},
        {9.51569E-01, 5.56783E-01, 6.29846E-05, 0.0845000000},
        {9.46654E-01, 5.40896E-01, 5.75163E-05, 0.0793000000},
        {9.40962E-01, 5.24912E-01, 5.25432E-05, 0.0745000000},
        {9.34600E-01, 5.08817E-01, 4.80192E-05, 0.0699000000},
        {9.27673E-01, 4.92599E-01, 4.39024E-05, 0.0655000000},
        {9.20264E-01, 4.76268E-01, 4.01551E-05, 0.0613000000},
        {9.12391E-01, 4.59893E-01, 3.67431E-05, 0.0574000000},
        {9.04050E-01, 4.43551E-01, 3.36353E-05, 0.0537000000},
        {8.95243E-01, 4.27314E-01, 3.08037E-05, 0.0502000000},
        {8.85969E-01, 4.11246E-01, 2.82228E-05, 0.0469000000},
        {8.76242E-01, 3.95396E-01, 2.58697E-05, 0.0438000000},
        {8.66117E-01, 3.79782E-01, 2.37235E-05, 0.0409000000},
        {8.55658E-01, 3.64410E-01, 2.17653E-05, 0.0381600000},
        {8.44926E-01, 3.49289E-01, 1.99779E-05, 0.0355800000},
        {8.33982E-01, 3.34429E-01, 1.83459E-05, 0.0331500000},
        {8.22859E-01, 3.19843E-01, 1.68551E-05, 0.0308700000},
        {8.11491E-01, 3.05564E-01, 1.54929E-05, 0.0287400000},
        {7.99794E-01, 2.91625E-01, 1.42476E-05, 0.0267400000},
        {7.87689E-01, 2.78053E-01, 1.31087E-05, 0.0248700000},
        {7.75103E-01, 2.64872E-01, 1.20667E-05, 0.0231200000},
        {7.61996E-01, 2.52099E-01, 1.11131E-05, 0.0214700000},
        {7.48425E-01, 2.39747E-01, 1.02399E-05, 0.0199400000},
        {7.34470E-01, 2.27822E-01, 9.43999E-06, 0.0185100000},
        {7.20208E-01, 2.16330E-01, 8.70695E-06, 0.0171800000},
        {7.05713E-01, 2.05273E-01, 8.03488E-06, 0.0159300000},
        {6.91044E-01, 1.94650E-01, 7.41844E-06, 0.0147700000},
        {6.76212E-01, 1.84448E-01, 6.85279E-06, 0.0136900000},
        {6.61220E-01, 1.74654E-01, 6.33352E-06, 0.0126900000},
        {6.46072E-01, 1.65256E-01, 5.85662E-06, 0.0117500000},
        {6.30773E-01, 1.56243E-01, 5.41843E-06, 0.0108800000},
        {6.15349E-01, 1.47602E-01, 0.00000E+00, 0.0100700000},
        {5.99888E-01, 1.39329E-01, 0.00000E+00, 0.0093200000},
        {5.84489E-01, 1.31416E-01, 0.00000E+00, 0.0086200000},
        {5.69240E-01, 1.23856E-01, 0.00000E+00, 0.0079700000},
        {5.54224E-01, 1.16641E-01, 0.00000E+00, 0.0073700000},
        {5.39469E-01, 1.09766E-01, 0.00000E+00, 0.0068200000},
        {5.24827E-01, 1.03226E-01, 0.00000E+00, 0.0063000000},
        {5.10124E-01, 9.70205E-02, 0.00000E+00, 0.0058200000},
        {4.95206E-01, 9.11430E-02, 0.00000E+00, 0.0053800000},
        {4.79941E-01, 8.55872E-02, 0.00000E+00, 0.0049700000},
        {4.64270E-01, 8.03428E-02, 0.00000E+00, 0.0045900000},
        {4.48338E-01, 7.53913E-02, 0.00000E+00, 0.0042400000},
        {4.32329E-01, 7.07136E-02, 0.00000E+00, 0.0039130000},
        {4.16406E-01, 6.62924E-02, 0.00000E+00, 0.0036130000},
        {4.00711E-01, 6.21120E-02, 0.00000E+00, 0.0033350000},
        {3.85355E-01, 5.81595E-02, 0.00000E+00, 0.0030790000},
        {3.70377E-01, 5.44276E-02, 0.00000E+00, 0.0028420000},
        {3.55793E-01, 5.09098E-02, 0.00000E+00, 0.0026230000},
        {3.41618E-01, 4.75991E-02, 0.00000E+00, 0.0024210000},
        {3.27864E-01, 4.44879E-02, 0.00000E+00, 0.0022350000},
        {3.14541E-01, 4.15659E-02, 0.00000E+00, 0.0020620000},
        {3.01662E-01, 3.88152E-02, 0.00000E+00, 0.0019030000},
        {2.89239E-01, 3.62181E-02, 0.00000E+00, 0.0017570000},
        {2.77278E-01, 3.37599E-02, 0.00000E+00, 0.0016210000},
        {2.65784E-01, 3.14282E-02, 0.00000E+00, 0.0014970000},
        {2.54740E-01, 2.92176E-02, 0.00000E+00, 0.0013820000},
        {2.44054E-01, 2.71403E-02, 0.00000E+00, 0.0012760000},
        {2.33634E-01, 2.52084E-02, 0.00000E+00, 0.0011780000},
        {2.23399E-01, 2.34286E-02, 0.00000E+00, 0.0010880000},
        {2.13284E-01, 2.18037E-02, 0.00000E+00, 0.0010050000},
        {2.03257E-01, 2.03285E-02, 0.00000E+00, 0.0009280000},
        {1.93370E-01, 1.89779E-02, 0.00000E+00, 0.0008570000},
        {1.83688E-01, 1.77272E-02, 0.00000E+00, 0.0007920000},
        {1.74263E-01, 1.65560E-02, 0.00000E+00, 0.0007320000},
        {1.65141E-01, 1.54480E-02, 0.00000E+00, 0.0006770000},
        {1.56354E-01, 1.43924E-02, 0.00000E+00, 0.0006260000},
        {1.47916E-01, 1.33896E-02, 0.00000E+00, 0.0005790000},
        {1.39834E-01, 1.24414E-02, 0.00000E+00, 0.0005360000},
        {1.32111E-01, 1.15488E-02, 0.00000E+00, 0.0004960000},
        {1.24749E-01, 1.07120E-02, 0.00000E+00, 0.0004590000},
        {1.17744E-01, 9.92994E-03, 0.00000E+00, 0.0004250000},
        {1.11081E-01, 9.20057E-03, 0.00000E+00, 0.0003935000},
        {1.04747E-01, 8.52126E-03, 0.00000E+00, 0.0003645000},
        {9.87277E-02, 7.88945E-03, 0.00000E+00, 0.0003377000},
        {9.30085E-02, 7.30255E-03, 0.00000E+00, 0.0003129000},
        {8.75769E-02, 6.75820E-03, 0.00000E+00, 0.0002901000},
        {8.24219E-02, 6.25474E-03, 0.00000E+00, 0.0002689000},
        {7.75328E-02, 5.79045E-03, 0.00000E+00, 0.0002493000},
        {7.28989E-02, 5.36347E-03, 0.00000E+00, 0.0002313000},
        {6.85100E-02, 4.97179E-03, 0.00000E+00, 0.0002146000},
        {6.43554E-02, 4.61300E-03, 0.00000E+00, 0.0001991000},
        {6.04242E-02, 4.28339E-03, 0.00000E+00, 0.0001848000},
        {5.67057E-02, 3.97940E-03, 0.00000E+00, 0.0001716000},
        {5.31896E-02, 3.69803E-03, 0.00000E+00, 0.0001593000},
        {4.98661E-02, 3.43667E-03, 0.00000E+00, 0.0001480000},
        {4.67258E-02, 3.19326E-03, 0.00000E+00, 0.0001375000},
        {4.37598E-02, 2.96653E-03, 0.00000E+00, 0.0001277000},
        {4.09594E-02, 2.75543E-03, 0.00000E+00, 0.0001187000},
        {3.83165E-02, 2.55896E-03, 0.00000E+00, 0.0001104000},
        {3.58233E-02, 2.37617E-03, 0.00000E+00, 0.0001026000},
        {3.34725E-02, 2.20618E-03, 0.00000E+00, 0.0000954000},
        {3.12583E-02, 2.04809E-03, 0.00000E+00, 0.0000888000},
        {2.91751E-02, 1.90110E-03, 0.00000E+00, 0.0000826000},
        {2.72173E-02, 1.76442E-03, 0.00000E+00, 0.0000769000},
        {2.53790E-02, 1.63734E-03, 0.00000E+00, 0.0000715000},
        {2.36541E-02, 1.51916E-03, 0.00000E+00, 0.0000666000},
        {2.20336E-02, 1.40913E-03, 0.00000E+00, 0.0000620000},
        {2.05092E-02, 1.30655E-03, 0.00000E+00, 0.0000578000},
        {1.90735E-02, 1.21078E-03, 0.00000E+00, 0.0000538000},
        {1.77201E-02, 1.12128E-03, 0.00000E+00, 0.0000501000},
        {1.64451E-02, 1.03766E-03, 0.00000E+00, 0.0000467000},
        {1.52510E-02, 9.59892E-04, 0.00000E+00, 0.0000436000},
        {1.41404E-02, 8.87951E-04, 0.00000E+00, 0.0000406000},
        {1.31137E-02, 8.21729E-04, 0.00000E+00, 0.0000378900},
        {1.21701E-02, 7.61051E-04, 0.00000E+00, 0.0000353300},
        {1.13063E-02, 7.05623E-04, 0.00000E+00, 0.0000329500},
        {1.05131E-02, 6.54874E-04, 0.00000E+00, 0.0000307500},
        {9.78127E-03, 6.08240E-04, 0.00000E+00, 0.0000287000},
        {9.10300E-03, 5.65240E-04, 0.00000E+00, 0.0000267900},
        {8.47170E-03, 5.25457E-04, 0.00000E+00, 0.0000250100},
        {7.88227E-03, 4.88550E-04, 0.00000E+00, 0.0000233600},
        {7.33213E-03, 4.54277E-04, 0.00000E+00, 0.0000218200},
        {6.81928E-03, 4.22436E-04, 0.00000E+00, 0.0000203800},
        {6.34173E-03, 3.92839E-04, 0.00000E+00, 0.0000190500},
        {5.89749E-03, 3.65317E-04, 0.00000E+00, 0.0000178000},
        {5.48444E-03, 3.39710E-04, 0.00000E+00, 0.0000166400},
        {5.09978E-03, 3.15856E-04, 0.00000E+00, 0.0000155600},
        {4.74086E-03, 2.93607E-04, 0.00000E+00, 0.0000145400},
        {4.40538E-03, 2.72834E-04, 0.00000E+00, 0.0000136000},
        {4.09129E-03, 2.53417E-04, 0.00000E+00, 0.0000127300},
        {3.79703E-03, 2.35265E-04, 0.00000E+00, 0.0000119100},
        {3.52187E-03, 2.18331E-04, 0.00000E+00, 0.0000111400},
        {3.26520E-03, 2.02574E-04, 0.00000E+00, 0.0000104300},
        {3.02632E-03, 1.87948E-04, 0.00000E+00, 0.0000097600},
        {2.80447E-03, 1.74402E-04, 0.00000E+00, 0.0000091400},
        {2.59882E-03, 1.61878E-04, 0.00000E+00, 0.0000085600},
        {2.40849E-03, 1.50305E-04, 0.00000E+00, 0.0000080200},
        {2.23259E-03, 1.39612E-04, 0.00000E+00, 0.0000075100},
        {2.07024E-03, 1.29734E-04, 0.00000E+00, 0.0000070400},
        {1.92058E-03, 1.20608E-04, 0.00000E+00, 0.0000066000},
        {1.78269E-03, 1.12176E-04, 0.00000E+00, 0.0000061800},
        {1.65540E-03, 1.04373E-04, 0.00000E+00, 0.0000058000},
        {1.53762E-03, 9.71383E-05, 0.00000E+00, 0.0000054400},
        {1.42839E-03, 9.04202E-05, 0.00000E+00, 0.0000051000},
        {1.32687E-03, 8.41716E-05, 0.00000E+00, 0.0000047800},
        {1.23238E-03, 7.83538E-05, 0.00000E+00, 0.0000044900},
        {1.14456E-03, 7.29425E-05, 0.00000E+00, 0.0000042100},
        {1.06308E-03, 6.79164E-05, 0.00000E+00, 0.0000039510},
        {9.87592E-04, 6.32542E-05, 0.00000E+00, 0.0000037090},
        {9.17777E-04, 5.89349E-05, 0.00000E+00, 0.0000034820},
        {8.53264E-04, 5.49360E-05, 0.00000E+00, 0.0000032700},
        {7.93589E-04, 5.12291E-05, 0.00000E+00, 0.0000030700},
        {7.38306E-04, 4.77872E-05, 0.00000E+00, 0.0000028840},
        {6.87018E-04, 4.45862E-05, 0.00000E+00, 0.0000027100},
        {6.39373E-04, 4.16049E-05, 0.00000E+00, 0.0000025460},
        {5.95057E-04, 3.88245E-05, 0.00000E+00, 0.0000023930},
        {5.53797E-04, 3.62302E-05, 0.00000E+00, 0.0000022500},
        {5.15350E-04, 3.38086E-05, 0.00000E+00, 0.0000021150},
        {4.79496E-04, 3.15474E-05, 0.00000E+00, 0.0000019890},
        {4.46035E-04, 2.94354E-05, 0.00000E+00, 0.0000018700},
        {4.14809E-04, 2.74634E-05, 0.00000E+00, 0.0000017590},
        {3.85749E-04, 2.56268E-05, 0.00000E+00, 0.0000016550},
        {3.58792E-04, 2.39217E-05, 0.00000E+00, 0.0000015570},
        {3.33861E-04, 2.23432E-05, 0.00000E+00, 0.0000014660},
        {3.10869E-04, 2.08860E-05, 0.00000E+00, 0.0000013790},
        {2.89699E-04, 1.95424E-05, 0.00000E+00, 0.0000012990},
        {2.70145E-04, 1.82990E-05, 0.00000E+00, 0.0000012230},
        {2.52007E-04, 1.71423E-05, 0.00000E+00, 0.0000011510},
        {2.35117E-04, 1.60611E-05, 0.00000E+00, 0.0000010840},
        {2.19329E-04, 1.50458E-05, 0.00000E+00, 0.0000010220},
        {2.04535E-04, 1.40893E-05, 0.00000E+00, 0.0000009620},
        {1.90692E-04, 1.31899E-05, 0.00000E+00, 0.0000009070},
        {1.77771E-04, 1.23462E-05, 0.00000E+00, 0.0000008550},
        {1.65736E-04, 1.15569E-05, 0.00000E+00, 0.0000008060},
        {1.54549E-04, 1.08200E-05, 0.00000E+00, 0.0000007600},
        {1.44167E-04, 1.01334E-05, 0.00000E+00, 0.0000007160},
        {1.34528E-04, 9.49367E-06, 0.00000E+00, 0.0000006750},
        {1.25574E-04, 8.89736E-06, 0.00000E+00, 0.0000006370},
        {1.17251E-04, 8.34135E-06, 0.00000E+00, 0.0000006010},
        {1.09508E-04, 7.82271E-06, 0.00000E+00, 0.0000005670},
        {1.02300E-04, 7.33865E-06, 0.00000E+00, 0.0000005350},
        {9.55828E-05, 6.88612E-06, 0.00000E+00, 0.0000005050},
        {8.93161E-05, 6.46228E-06, 0.00000E+00, 0.0000004770},
        {8.34631E-05, 6.06462E-06, 0.00000E+00, 0.0000004500},
        {7.79912E-05, 5.69093E-06, 0.00000E+00, 0.0000004250},
        {7.28730E-05, 5.33942E-06, 0.00000E+00, 0.0000004010},
        {6.80921E-05, 5.00929E-06, 0.00000E+00, 0.0000003790},
        {6.36342E-05, 4.69984E-06, 0.00000E+00, 0.0000003580},
        {5.94841E-05, 4.41034E-06, 0.00000E+00, 0.0000003382},
        {5.56264E-05, 4.13998E-06, 0.00000E+00, 0.0000003196},
        {5.20430E-05, 3.88772E-06, 0.00000E+00, 0.0000003021},
        {4.87063E-05, 3.65186E-06, 0.00000E+00, 0.0000002855},
        {4.55900E-05, 3.43070E-06, 0.00000E+00, 0.0000002699},
        {4.26710E-05, 3.22278E-06, 0.00000E+00, 0.0000002552},
        {3.99295E-05, 3.02683E-06, 0.00000E+00, 0.0000002413},
        {3.73509E-05, 2.84192E-06, 0.00000E+00, 0.0000002282},
        {3.49326E-05, 2.66795E-06, 0.00000E+00, 0.0000002159},
        {3.26730E-05, 2.50491E-06, 0.00000E+00, 0.0000002042},
        {3.05690E-05, 2.35267E-06, 0.00000E+00, 0.0000001932},
        {2.86163E-05, 2.21100E-06, 0.00000E+00, 0.0000001829},
        {2.68077E-05, 2.07946E-06, 0.00000E+00, 0.0000001731},
        {2.51286E-05, 1.95700E-06, 0.00000E+00, 0.0000001638},
        {2.35645E-05, 1.84258E-06, 0.00000E+00, 0.0000001551},
        {2.21026E-05, 1.73528E-06, 0.00000E+00, 0.0000001468},
        {2.07321E-05, 1.63433E-06, 0.00000E+00, 0.0000001390}
};

// CIE 1931 2-deg, XYZ CMFs, Y only
//
// Data source:
//     http://www.cvrl.org/cmfs.htm
const size_t CIE_Y_COUNT = 401;
const float CIE_Y[CIE_Y_COUNT] = { // NOLINT
        0.000120000000,
        0.000134984000,
        0.000151492000,
        0.000170208000,
        0.000191816000,
        0.000217000000,
        0.000246906700,
        0.000281240000,
        0.000318520000,
        0.000357266700,
        0.000396000000,
        0.000433714700,
        0.000473024000,
        0.000517876000,
        0.000572218700,
        0.000640000000,
        0.000724560000,
        0.000825500000,
        0.000941160000,
        0.001069880000,
        0.001210000000,
        0.001362091000,
        0.001530752000,
        0.001720368000,
        0.001935323000,
        0.002180000000,
        0.002454800000,
        0.002764000000,
        0.003117800000,
        0.003526400000,
        0.004000000000,
        0.004546240000,
        0.005159320000,
        0.005829280000,
        0.006546160000,
        0.007300000000,
        0.008086507000,
        0.008908720000,
        0.009767680000,
        0.010664430000,
        0.011600000000,
        0.012573170000,
        0.013582720000,
        0.014629680000,
        0.015715090000,
        0.016840000000,
        0.018007360000,
        0.019214480000,
        0.020453920000,
        0.021718240000,
        0.023000000000,
        0.024294610000,
        0.025610240000,
        0.026958570000,
        0.028351250000,
        0.029800000000,
        0.031310830000,
        0.032883680000,
        0.034521120000,
        0.036225710000,
        0.038000000000,
        0.039846670000,
        0.041768000000,
        0.043766000000,
        0.045842670000,
        0.048000000000,
        0.050243680000,
        0.052573040000,
        0.054980560000,
        0.057458720000,
        0.060000000000,
        0.062601970000,
        0.065277520000,
        0.068042080000,
        0.070911090000,
        0.073900000000,
        0.077016000000,
        0.080266400000,
        0.083666800000,
        0.087232800000,
        0.090980000000,
        0.094917550000,
        0.099045840000,
        0.103367400000,
        0.107884600000,
        0.112600000000,
        0.117532000000,
        0.122674400000,
        0.127992800000,
        0.133452800000,
        0.139020000000,
        0.144676400000,
        0.150469300000,
        0.156461900000,
        0.162717700000,
        0.169300000000,
        0.176243100000,
        0.183558100000,
        0.191273500000,
        0.199418000000,
        0.208020000000,
        0.217119900000,
        0.226734500000,
        0.236857100000,
        0.247481200000,
        0.258600000000,
        0.270184900000,
        0.282293900000,
        0.295050500000,
        0.308578000000,
        0.323000000000,
        0.338402100000,
        0.354685800000,
        0.371698600000,
        0.389287500000,
        0.407300000000,
        0.425629900000,
        0.444309600000,
        0.463394400000,
        0.482939500000,
        0.503000000000,
        0.523569300000,
        0.544512000000,
        0.565690000000,
        0.586965300000,
        0.608200000000,
        0.629345600000,
        0.650306800000,
        0.670875200000,
        0.690842400000,
        0.710000000000,
        0.728185200000,
        0.745463600000,
        0.761969400000,
        0.777836800000,
        0.793200000000,
        0.808110400000,
        0.822496200000,
        0.836306800000,
        0.849491600000,
        0.862000000000,
        0.873810800000,
        0.884962400000,
        0.895493600000,
        0.905443200000,
        0.914850100000,
        0.923734800000,
        0.932092400000,
        0.939922600000,
        0.947225200000,
        0.954000000000,
        0.960256100000,
        0.966007400000,
        0.971260600000,
        0.976022500000,
        0.980300000000,
        0.984092400000,
        0.987418200000,
        0.990312800000,
        0.992811600000,
        0.994950100000,
        0.996710800000,
        0.998098300000,
        0.999112000000,
        0.999748200000,
        1.000000000000,
        0.999856700000,
        0.999304600000,
        0.998325500000,
        0.996898700000,
        0.995000000000,
        0.992600500000,
        0.989742600000,
        0.986444400000,
        0.982724100000,
        0.978600000000,
        0.974083700000,
        0.969171200000,
        0.963856800000,
        0.958134900000,
        0.952000000000,
        0.945450400000,
        0.938499200000,
        0.931162800000,
        0.923457600000,
        0.915400000000,
        0.907006400000,
        0.898277200000,
        0.889204800000,
        0.879781600000,
        0.870000000000,
        0.859861300000,
        0.849392000000,
        0.838622000000,
        0.827581300000,
        0.816300000000,
        0.804794700000,
        0.793082000000,
        0.781192000000,
        0.769154700000,
        0.757000000000,
        0.744754100000,
        0.732422400000,
        0.720003600000,
        0.707496500000,
        0.694900000000,
        0.682219200000,
        0.669471600000,
        0.656674400000,
        0.643844800000,
        0.631000000000,
        0.618155500000,
        0.605314400000,
        0.592475600000,
        0.579637900000,
        0.566800000000,
        0.553961100000,
        0.541137200000,
        0.528352800000,
        0.515632300000,
        0.503000000000,
        0.490468800000,
        0.478030400000,
        0.465677600000,
        0.453403200000,
        0.441200000000,
        0.429080000000,
        0.417036000000,
        0.405032000000,
        0.393032000000,
        0.381000000000,
        0.368918400000,
        0.356827200000,
        0.344776800000,
        0.332817600000,
        0.321000000000,
        0.309338100000,
        0.297850400000,
        0.286593600000,
        0.275624500000,
        0.265000000000,
        0.254763200000,
        0.244889600000,
        0.235334400000,
        0.226052800000,
        0.217000000000,
        0.208161600000,
        0.199548800000,
        0.191155200000,
        0.182974400000,
        0.175000000000,
        0.167223500000,
        0.159646400000,
        0.152277600000,
        0.145125900000,
        0.138200000000,
        0.131500300000,
        0.125024800000,
        0.118779200000,
        0.112769100000,
        0.107000000000,
        0.101476200000,
        0.096188640000,
        0.091122960000,
        0.086264850000,
        0.081600000000,
        0.077120640000,
        0.072825520000,
        0.068710080000,
        0.064769760000,
        0.061000000000,
        0.057396210000,
        0.053955040000,
        0.050673760000,
        0.047549650000,
        0.044580000000,
        0.041758720000,
        0.039084960000,
        0.036563840000,
        0.034200480000,
        0.032000000000,
        0.029962610000,
        0.028076640000,
        0.026329360000,
        0.024708050000,
        0.023200000000,
        0.021800770000,
        0.020501120000,
        0.019281080000,
        0.018120690000,
        0.017000000000,
        0.015903790000,
        0.014837180000,
        0.013810680000,
        0.012834780000,
        0.011920000000,
        0.011068310000,
        0.010273390000,
        0.009533311000,
        0.008846157000,
        0.008210000000,
        0.007623781000,
        0.007085424000,
        0.006591476000,
        0.006138485000,
        0.005723000000,
        0.005343059000,
        0.004995796000,
        0.004676404000,
        0.004380075000,
        0.004102000000,
        0.003838453000,
        0.003589099000,
        0.003354219000,
        0.003134093000,
        0.002929000000,
        0.002738139000,
        0.002559876000,
        0.002393244000,
        0.002237275000,
        0.002091000000,
        0.001953587000,
        0.001824580000,
        0.001703580000,
        0.001590187000,
        0.001484000000,
        0.001384496000,
        0.001291268000,
        0.001204092000,
        0.001122744000,
        0.001047000000,
        0.000976589600,
        0.000911108800,
        0.000850133200,
        0.000793238400,
        0.000740000000,
        0.000690082700,
        0.000643310000,
        0.000599496000,
        0.000558454700,
        0.000520000000,
        0.000483913600,
        0.000450052800,
        0.000418345200,
        0.000388718400,
        0.000361100000,
        0.000335383500,
        0.000311440400,
        0.000289165600,
        0.000268453900,
        0.000249200000,
        0.000231301900,
        0.000214685600,
        0.000199288400,
        0.000185047500,
        0.000171900000,
        0.000159778100,
        0.000148604400,
        0.000138301600,
        0.000128792500,
        0.000120000000,
        0.000111859500,
        0.000104322400,
        0.000097335600,
        0.000090845870,
        0.000084800000,
        0.000079146670,
        0.000073858000,
        0.000068916000,
        0.000064302670,
        0.000060000000,
        0.000055981870,
        0.000052225600,
        0.000048718400,
        0.000045447470,
        0.000042400000,
        0.000039561040,
        0.000036915120,
        0.000034448680,
        0.000032148160,
        0.000030000000,
        0.000027991250,
        0.000026113560,
        0.000024360240,
        0.000022724610,
        0.000021200000,
        0.000019778550,
        0.000018452850,
        0.000017216870,
        0.000016064590,
        0.000014990000,
        0.000013987280,
        0.000013051550,
        0.000012178180,
        0.000011362540,
        0.000010600000,
        0.000009885877,
        0.000009217304,
        0.000008592362,
        0.000008009133,
        0.000007465700,
};

// CIE Standard Illuminant D65 relative spectral power distribution,
// from 390nm to 790nm, at 1nm intervals
//
// Data source:
//     https://en.wikipedia.org/wiki/Illuminant_D65
//     https://www.rit.edu/cos/colorscience/rc_useful_data.php
const size_t CIE_D65_INTERVAL = 1;
const size_t CIE_D65_START = 390;
const size_t CIE_D65_END = 790;
const size_t CIE_D65_COUNT = 401;
const float CIE_D65[CIE_D65_COUNT] = {
        54.6482,
        57.4589,
        60.2695,
        63.0802,
        65.8909,
        68.7015,
        71.5122,
        74.3229,
        77.1336,
        79.9442,
        82.7549,
        83.628,
        84.5011,
        85.3742,
        86.2473,
        87.1204,
        87.9936,
        88.8667,
        89.7398,
        90.6129,
        91.486,
        91.6806,
        91.8752,
        92.0697,
        92.2643,
        92.4589,
        92.6535,
        92.8481,
        93.0426,
        93.2372,
        93.4318,
        92.7568,
        92.0819,
        91.4069,
        90.732,
        90.057,
        89.3821,
        88.7071,
        88.0322,
        87.3572,
        86.6823,
        88.5006,
        90.3188,
        92.1371,
        93.9554,
        95.7736,
        97.5919,
        99.4102,
        101.228,
        103.047,
        104.865,
        106.079,
        107.294,
        108.508,
        109.722,
        110.936,
        112.151,
        113.365,
        114.579,
        115.794,
        117.008,
        117.088,
        117.169,
        117.249,
        117.33,
        117.41,
        117.49,
        117.571,
        117.651,
        117.732,
        117.812,
        117.517,
        117.222,
        116.927,
        116.632,
        116.336,
        116.041,
        115.746,
        115.451,
        115.156,
        114.861,
        114.967,
        115.073,
        115.18,
        115.286,
        115.392,
        115.498,
        115.604,
        115.711,
        115.817,
        115.923,
        115.212,
        114.501,
        113.789,
        113.078,
        112.367,
        111.656,
        110.945,
        110.233,
        109.522,
        108.811,
        108.865,
        108.92,
        108.974,
        109.028,
        109.082,
        109.137,
        109.191,
        109.245,
        109.3,
        109.354,
        109.199,
        109.044,
        108.888,
        108.733,
        108.578,
        108.423,
        108.268,
        108.112,
        107.957,
        107.802,
        107.501,
        107.2,
        106.898,
        106.597,
        106.296,
        105.995,
        105.694,
        105.392,
        105.091,
        104.79,
        105.08,
        105.37,
        105.66,
        105.95,
        106.239,
        106.529,
        106.819,
        107.109,
        107.399,
        107.689,
        107.361,
        107.032,
        106.704,
        106.375,
        106.047,
        105.719,
        105.39,
        105.062,
        104.733,
        104.405,
        104.369,
        104.333,
        104.297,
        104.261,
        104.225,
        104.19,
        104.154,
        104.118,
        104.082,
        104.046,
        103.641,
        103.237,
        102.832,
        102.428,
        102.023,
        101.618,
        101.214,
        100.809,
        100.405,
        100.0,
        99.6334,
        99.2668,
        98.9003,
        98.5337,
        98.1671,
        97.8005,
        97.4339,
        97.0674,
        96.7008,
        96.3342,
        96.2796,
        96.225,
        96.1703,
        96.1157,
        96.0611,
        96.0065,
        95.9519,
        95.8972,
        95.8426,
        95.788,
        95.0778,
        94.3675,
        93.6573,
        92.947,
        92.2368,
        91.5266,
        90.8163,
        90.1061,
        89.3958,
        88.6856,
        88.8177,
        88.9497,
        89.0818,
        89.2138,
        89.3459,
        89.478,
        89.61,
        89.7421,
        89.8741,
        90.0062,
        89.9655,
        89.9248,
        89.8841,
        89.8434,
        89.8026,
        89.7619,
        89.7212,
        89.6805,
        89.6398,
        89.5991,
        89.4091,
        89.219,
        89.029,
        88.8389,
        88.6489,
        88.4589,
        88.2688,
        88.0788,
        87.8887,
        87.6987,
        87.2577,
        86.8167,
        86.3757,
        85.9347,
        85.4936,
        85.0526,
        84.6116,
        84.1706,
        83.7296,
        83.2886,
        83.3297,
        83.3707,
        83.4118,
        83.4528,
        83.4939,
        83.535,
        83.576,
        83.6171,
        83.6581,
        83.6992,
        83.332,
        82.9647,
        82.5975,
        82.2302,
        81.863,
        81.4958,
        81.1285,
        80.7613,
        80.394,
        80.0268,
        80.0456,
        80.0644,
        80.0831,
        80.1019,
        80.1207,
        80.1395,
        80.1583,
        80.177,
        80.1958,
        80.2146,
        80.4209,
        80.6272,
        80.8336,
        81.0399,
        81.2462,
        81.4525,
        81.6588,
        81.8652,
        82.0715,
        82.2778,
        81.8784,
        81.4791,
        81.0797,
        80.6804,
        80.281,
        79.8816,
        79.4823,
        79.0829,
        78.6836,
        78.2842,
        77.4279,
        76.5716,
        75.7153,
        74.859,
        74.0027,
        73.1465,
        72.2902,
        71.4339,
        70.5776,
        69.7213,
        69.9101,
        70.0989,
        70.2876,
        70.4764,
        70.6652,
        70.854,
        71.0428,
        71.2315,
        71.4203,
        71.6091,
        71.8831,
        72.1571,
        72.4311,
        72.7051,
        72.979,
        73.253,
        73.527,
        73.801,
        74.075,
        74.349,
        73.0745,
        71.8,
        70.5255,
        69.251,
        67.9765,
        66.702,
        65.4275,
        64.153,
        62.8785,
        61.604,
        62.4322,
        63.2603,
        64.0885,
        64.9166,
        65.7448,
        66.573,
        67.4011,
        68.2293,
        69.0574,
        69.8856,
        70.4057,
        70.9259,
        71.446,
        71.9662,
        72.4863,
        73.0064,
        73.5266,
        74.0467,
        74.5669,
        75.087,
        73.9376,
        72.7881,
        71.6387,
        70.4893,
        69.3398,
        68.1904,
        67.041,
        65.8916,
        64.7421,
        63.5927,
        61.8752,
        60.1578,
        58.4403,
        56.7229,
        55.0054,
        53.288,
        51.5705,
        49.8531,
        48.1356,
        46.4182,
        48.4569,
        50.4956,
        52.5344,
        54.5731,
        56.6118,
        58.6505,
        60.6892,
        62.728,
        64.7667,
        66.8054,
        66.4631,
        66.1209,
        65.7786,
        65.4364,
        65.0941,
        64.7518,
        64.4096,
        64.0673,
        63.7251,
        63.3828,
        63.4749,
        63.567,
        63.6592,
        63.7513,
        63.8434,
        63.9355,
        64.0276,
        64.1198,
        64.2119,
        64.304
};

int main(int argc, char* argv[]) {
    static_assert(CIE_LMSR_COUNT == CIE_D65_COUNT && CIE_LMSR_COUNT == REC_709_REFLECTANCE_COUNT);

    handleArguments(argc, argv);

    double norm = CIE_LMSR_COUNT;
    if (g_normalize) {
        norm = 0.0;
        for (size_t i = 0; i < CIE_D65_COUNT; i++) {
            norm += CIE_Y[i] * CIE_D65[i];
        }
    }
    norm = 1.0 / norm;

    double3 l{0.0};
    double3 m{0.0};
    double3 s{0.0};
    double3 r{0.0};

    for (size_t j = 0; j < 3; j++) {
        for (size_t w = 0; w < CIE_LMSR_COUNT; w++) {
            l[j] += CIE_LMSR[w].x * CIE_D65[w] * norm * REC_709_REFLECTANCE[w][j];
            m[j] += CIE_LMSR[w].y * CIE_D65[w] * norm * REC_709_REFLECTANCE[w][j];
            s[j] += CIE_LMSR[w].z * CIE_D65[w] * norm * REC_709_REFLECTANCE[w][j];
            r[j] += CIE_LMSR[w].w * CIE_D65[w] * norm * REC_709_REFLECTANCE[w][j];
        }
    }

    std::cout << "Rec.709 to LMSR matrix (4x3, column major):" << std::endl;
    std::cout << std::fixed << std::setprecision(6) << l.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << l.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << l.b << ", ";
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << m.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << m.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << m.b << ", ";
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << s.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << s.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << s.b << ", ";
    std::cout << std::endl;
    std::cout << std::fixed << std::setprecision(6) << r.r << ", ";
    std::cout << std::fixed << std::setprecision(6) << r.g << ", ";
    std::cout << std::fixed << std::setprecision(6) << r.b;
    std::cout << std::endl;

    return 0;
}
